
(function(){var $,Analyze,Blender,Calculate,Caman,CamanParser,Canvas,Convert,Event,Fiber,Filter,IO,Image,Layer,Log,Logger,PixelInfo,Plugin,Renderer,Root,Store,Util,fs,slice,vignetteFilters,__hasProp={}.hasOwnProperty,__indexOf=[].indexOf||function(item){for(var i=0,l=this.length;i<l;i++){if(i in this&&this[i]===item)return i;}return-1;},__slice=[].slice,_this=this;slice=Array.prototype.slice;$=function(sel,root){if(root==null){root=document;}
if(typeof sel==="object"||(typeof exports!=="undefined"&&exports!==null)){return sel;}
return root.querySelector(sel);};Util=(function(){function Util(){}
Util.uniqid=(function(){var id;id=0;return{get:function(){return id++;}};})();Util.extend=function(obj){var copy,dest,prop,src,_i,_len;dest=obj;src=slice.call(arguments,1);for(_i=0,_len=src.length;_i<_len;_i++){copy=src[_i];for(prop in copy){if(!__hasProp.call(copy,prop))continue;dest[prop]=copy[prop];}}
return dest;};Util.clampRGB=function(val){if(val<0){return 0;}
if(val>255){return 255;}
return val;};Util.copyAttributes=function(from,to,opts){var attr,_i,_len,_ref,_ref1,_results;if(opts==null){opts={};}
_ref=from.attributes;_results=[];for(_i=0,_len=_ref.length;_i<_len;_i++){attr=_ref[_i];if((opts.except!=null)&&(_ref1=attr.nodeName,__indexOf.call(opts.except,_ref1)>=0)){continue;}
_results.push(to.setAttribute(attr.nodeName,attr.nodeValue));}
return _results;};Util.dataArray=function(length){if(length==null){length=0;}
if(Caman.NodeJS||(window.Uint8Array!=null)){return new Uint8Array(length);}
return new Array(length);};return Util;})();if(typeof exports!=="undefined"&&exports!==null){Root=exports;Canvas=require('canvas');Image=Canvas.Image;Fiber=require('fibers');fs=require('fs');}else{Root=window;}
Root.Caman=Caman=(function(){Caman.version={release:"4.1.1",date:"4/8/2013"};Caman.DEBUG=false;Caman.NodeJS=typeof exports!=="undefined"&&exports!==null;Caman.autoload=!Caman.NodeJS;Caman.allowRevert=true;Caman.crossOrigin="anonymous";Caman.toString=function(){return"Version "+Caman.version.release+", Released "+Caman.version.date;};Caman.remoteProxy="";Caman.proxyParam="camanProxyUrl";Caman.getAttrId=function(canvas){if(Caman.NodeJS){return true;}
if(typeof canvas==="string"){canvas=$(canvas);}
if(!((canvas!=null)&&(canvas.getAttribute!=null))){return null;}
return canvas.getAttribute('data-caman-id');};function Caman(){var args,callback,id,_this=this;if(arguments.length===0){throw"Invalid arguments";}
if(this instanceof Caman){this.finishInit=this.finishInit.bind(this);this.imageLoaded=this.imageLoaded.bind(this);args=arguments[0];if(!Caman.NodeJS){id=parseInt(Caman.getAttrId(args[0]),10);callback=typeof args[1]==="function"?args[1]:typeof args[2]==="function"?args[2]:function(){};if(!isNaN(id)&&Store.has(id)){return Store.execute(id,callback);}}
this.id=Util.uniqid.get();this.initializedPixelData=this.originalPixelData=null;this.cropCoordinates={x:0,y:0};this.cropped=false;this.resized=false;this.pixelStack=[];this.layerStack=[];this.canvasQueue=[];this.currentLayer=null;this.scaled=false;this.analyze=new Analyze(this);this.renderer=new Renderer(this);this.domIsLoaded(function(){_this.parseArguments(args);return _this.setup();});return this;}else{return new Caman(arguments);}}
Caman.prototype.domIsLoaded=function(cb){var listener,_this=this;if(Caman.NodeJS){return setTimeout(function(){return cb.call(_this);},0);}else{if(document.readyState==="complete"){Log.debug("DOM initialized");return setTimeout(function(){return cb.call(_this);},0);}else{listener=function(){if(document.readyState==="complete"){Log.debug("DOM initialized");return cb.call(_this);}};return document.addEventListener("readystatechange",listener,false);}}};Caman.prototype.parseArguments=function(args){var key,val,_ref,_results;if(args.length===0){throw"Invalid arguments given";}
this.initObj=null;this.initType=null;this.imageUrl=null;this.callback=function(){};this.setInitObject(args[0]);if(args.length===1){return;}
switch(typeof args[1]){case"string":this.imageUrl=args[1];break;case"function":this.callback=args[1];}
if(args.length===2){return;}
this.callback=args[2];if(args.length===4){_ref=args[4];_results=[];for(key in _ref){if(!__hasProp.call(_ref,key))continue;val=_ref[key];_results.push(this.options[key]=val);}
return _results;}};Caman.prototype.setInitObject=function(obj){if(Caman.NodeJS){this.initObj=obj;this.initType='node';return;}
if(typeof obj==="object"){this.initObj=obj;}else{this.initObj=$(obj);}
if(this.initObj==null){throw"Could not find image or canvas for initialization.";}
return this.initType=this.initObj.nodeName.toLowerCase();};Caman.prototype.setup=function(){switch(this.initType){case"node":return this.initNode();case"img":return this.initImage();case"canvas":return this.initCanvas();}};Caman.prototype.initNode=function(){var _this=this;Log.debug("Initializing for NodeJS");this.image=new Image();this.image.onload=function(){Log.debug("Image loaded. Width = "+(_this.imageWidth())+", Height = "+(_this.imageHeight()));_this.canvas=new Canvas(_this.imageWidth(),_this.imageHeight());return _this.finishInit();};this.image.onerror=function(err){throw err;};return this.image.src=this.initObj;};Caman.prototype.initImage=function(){this.image=this.initObj;this.canvas=document.createElement('canvas');this.context=this.canvas.getContext('2d');Util.copyAttributes(this.image,this.canvas,{except:['src']});this.image.parentNode.replaceChild(this.canvas,this.image);this.imageAdjustments();return this.waitForImageLoaded();};Caman.prototype.initCanvas=function(){this.canvas=this.initObj;this.context=this.canvas.getContext('2d');if(this.imageUrl!=null){this.image=document.createElement('img');this.image.src=this.imageUrl;this.imageAdjustments();return this.waitForImageLoaded();}else{return this.finishInit();}};Caman.prototype.imageAdjustments=function(){if(this.needsHiDPISwap()){Log.debug(this.image.src,"->",this.hiDPIReplacement());this.swapped=true;this.image.src=this.hiDPIReplacement();}
if(IO.isRemote(this.image)){this.image.src=IO.proxyUrl(this.image.src);return Log.debug("Remote image detected, using URL = "+this.image.src);}};Caman.prototype.waitForImageLoaded=function(){if(this.isImageLoaded()){return this.imageLoaded();}else{return this.image.onload=this.imageLoaded;}};Caman.prototype.isImageLoaded=function(){if(!this.image.complete){return false;}
if((this.image.naturalWidth!=null)&&this.image.naturalWidth===0){return false;}
return true;};Caman.prototype.imageWidth=function(){return this.image.width||this.image.naturalWidth;};Caman.prototype.imageHeight=function(){return this.image.height||this.image.naturalHeight;};Caman.prototype.imageLoaded=function(){Log.debug("Image loaded. Width = "+(this.imageWidth())+", Height = "+(this.imageHeight()));if(this.swapped){this.canvas.width=this.imageWidth()/this.hiDPIRatio();this.canvas.height=this.imageHeight()/this.hiDPIRatio();}else{this.canvas.width=this.imageWidth();this.canvas.height=this.imageHeight();}
return this.finishInit();};Caman.prototype.finishInit=function(){var i,pixel,_i,_len,_ref;if(this.context==null){this.context=this.canvas.getContext('2d');}
this.originalWidth=this.preScaledWidth=this.width=this.canvas.width;this.originalHeight=this.preScaledHeight=this.height=this.canvas.height;this.hiDPIAdjustments();if(!this.hasId()){this.assignId();}
if(this.image!=null){this.context.drawImage(this.image,0,0,this.imageWidth(),this.imageHeight(),0,0,this.preScaledWidth,this.preScaledHeight);}
this.reloadCanvasData();if(Caman.allowRevert){this.initializedPixelData=Util.dataArray(this.pixelData.length);this.originalPixelData=Util.dataArray(this.pixelData.length);_ref=this.pixelData;for(i=_i=0,_len=_ref.length;_i<_len;i=++_i){pixel=_ref[i];this.initializedPixelData[i]=pixel;this.originalPixelData[i]=pixel;}}
this.dimensions={width:this.canvas.width,height:this.canvas.height};Store.put(this.id,this);this.callback.call(this,this);return this.callback=function(){};};Caman.prototype.reloadCanvasData=function(){this.imageData=this.context.getImageData(0,0,this.canvas.width,this.canvas.height);return this.pixelData=this.imageData.data;};Caman.prototype.resetOriginalPixelData=function(){var pixel,_i,_len,_ref,_results;if(!Caman.allowRevert){throw"Revert disabled";}
this.originalPixelData=Util.dataArray(this.pixelData.length);_ref=this.pixelData;_results=[];for(_i=0,_len=_ref.length;_i<_len;_i++){pixel=_ref[_i];_results.push(this.originalPixelData.push(pixel));}
return _results;};Caman.prototype.hasId=function(){return Caman.getAttrId(this.canvas)!=null;};Caman.prototype.assignId=function(){if(Caman.NodeJS||this.canvas.getAttribute('data-caman-id')){return;}
return this.canvas.setAttribute('data-caman-id',this.id);};Caman.prototype.hiDPIDisabled=function(){return this.canvas.getAttribute('data-caman-hidpi-disabled')!==null;};Caman.prototype.hiDPIAdjustments=function(){var ratio;if(Caman.NodeJS||this.hiDPIDisabled()){return;}
ratio=this.hiDPIRatio();if(ratio!==1){Log.debug("HiDPI ratio = "+ratio);this.scaled=true;this.preScaledWidth=this.canvas.width;this.preScaledHeight=this.canvas.height;this.canvas.width=this.preScaledWidth*ratio;this.canvas.height=this.preScaledHeight*ratio;this.canvas.style.width=""+this.preScaledWidth+"px";this.canvas.style.height=""+this.preScaledHeight+"px";this.context.scale(ratio,ratio);this.width=this.originalWidth=this.canvas.width;return this.height=this.originalHeight=this.canvas.height;}};Caman.prototype.hiDPIRatio=function(){var backingStoreRatio,devicePixelRatio;devicePixelRatio=window.devicePixelRatio||1;backingStoreRatio=this.context.webkitBackingStorePixelRatio||this.context.mozBackingStorePixelRatio||this.context.msBackingStorePixelRatio||this.context.oBackingStorePixelRatio||this.context.backingStorePixelRatio||1;return devicePixelRatio/backingStoreRatio;};Caman.prototype.hiDPICapable=function(){return(window.devicePixelRatio!=null)&&window.devicePixelRatio!==1;};Caman.prototype.needsHiDPISwap=function(){if(this.hiDPIDisabled()||!this.hiDPICapable()){return false;}
return this.hiDPIReplacement()!==null;};Caman.prototype.hiDPIReplacement=function(){if(this.image==null){return null;}
return this.image.getAttribute('data-caman-hidpi');};Caman.prototype.replaceCanvas=function(newCanvas){var oldCanvas;oldCanvas=this.canvas;this.canvas=newCanvas;this.context=this.canvas.getContext('2d');oldCanvas.parentNode.replaceChild(this.canvas,oldCanvas);this.width=this.canvas.width;this.height=this.canvas.height;this.reloadCanvasData();return this.dimensions={width:this.canvas.width,height:this.canvas.height};};Caman.prototype.render=function(callback){var _this=this;if(callback==null){callback=function(){};}
Event.trigger(this,"renderStart");return this.renderer.execute(function(){_this.context.putImageData(_this.imageData,0,0);return callback.call(_this);});};Caman.prototype.revert=function(){var i,pixel,_i,_len,_ref;if(!Caman.allowRevert){throw"Revert disabled";}
_ref=this.originalVisiblePixels();for(i=_i=0,_len=_ref.length;_i<_len;i=++_i){pixel=_ref[i];this.pixelData[i]=pixel;}
return this.context.putImageData(this.imageData,0,0);};Caman.prototype.reset=function(){var canvas,ctx,i,imageData,pixel,pixelData,_i,_len,_ref;canvas=document.createElement('canvas');Util.copyAttributes(this.canvas,canvas);canvas.width=this.originalWidth;canvas.height=this.originalHeight;ctx=canvas.getContext('2d');imageData=ctx.getImageData(0,0,canvas.width,canvas.height);pixelData=imageData.data;_ref=this.initializedPixelData;for(i=_i=0,_len=_ref.length;_i<_len;i=++_i){pixel=_ref[i];pixelData[i]=pixel;}
ctx.putImageData(imageData,0,0);this.cropCoordinates={x:0,y:0};this.resized=false;return this.replaceCanvas(canvas);};Caman.prototype.originalVisiblePixels=function(){var canvas,coord,ctx,endX,endY,i,imageData,pixel,pixelData,pixels,scaledCanvas,startX,startY,width,_i,_j,_len,_ref,_ref1,_ref2,_ref3;if(!Caman.allowRevert){throw"Revert disabled";}
pixels=[];startX=this.cropCoordinates.x;endX=startX+this.width;startY=this.cropCoordinates.y;endY=startY+this.height;if(this.resized){canvas=document.createElement('canvas');canvas.width=this.originalWidth;canvas.height=this.originalHeight;ctx=canvas.getContext('2d');imageData=ctx.getImageData(0,0,canvas.width,canvas.height);pixelData=imageData.data;_ref=this.originalPixelData;for(i=_i=0,_len=_ref.length;_i<_len;i=++_i){pixel=_ref[i];pixelData[i]=pixel;}
ctx.putImageData(imageData,0,0);scaledCanvas=document.createElement('canvas');scaledCanvas.width=this.width;scaledCanvas.height=this.height;ctx=scaledCanvas.getContext('2d');ctx.drawImage(canvas,0,0,this.originalWidth,this.originalHeight,0,0,this.width,this.height);pixelData=ctx.getImageData(0,0,this.width,this.height).data;width=this.width;}else{pixelData=this.originalPixelData;width=this.originalWidth;}
for(i=_j=0,_ref1=pixelData.length;_j<_ref1;i=_j+=4){coord=PixelInfo.locationToCoordinates(i,width);if(((startX<=(_ref2=coord.x)&&_ref2<endX))&&((startY<=(_ref3=coord.y)&&_ref3<endY))){pixels.push(pixelData[i],pixelData[i+1],pixelData[i+2],pixelData[i+3]);}}
return pixels;};Caman.prototype.process=function(name,processFn){this.renderer.add({type:Filter.Type.Single,name:name,processFn:processFn});return this;};Caman.prototype.processKernel=function(name,adjust,divisor,bias){var i,_i,_ref;if(!divisor){divisor=0;for(i=_i=0,_ref=adjust.length;0<=_ref?_i<_ref:_i>_ref;i=0<=_ref?++_i:--_i){divisor+=adjust[i];}}
this.renderer.add({type:Filter.Type.Kernel,name:name,adjust:adjust,divisor:divisor,bias:bias||0});return this;};Caman.prototype.processPlugin=function(plugin,args){this.renderer.add({type:Filter.Type.Plugin,plugin:plugin,args:args});return this;};Caman.prototype.newLayer=function(callback){var layer;layer=new Layer(this);this.canvasQueue.push(layer);this.renderer.add({type:Filter.Type.LayerDequeue});callback.call(layer);this.renderer.add({type:Filter.Type.LayerFinished});return this;};Caman.prototype.executeLayer=function(layer){return this.pushContext(layer);};Caman.prototype.pushContext=function(layer){this.layerStack.push(this.currentLayer);this.pixelStack.push(this.pixelData);this.currentLayer=layer;return this.pixelData=layer.pixelData;};Caman.prototype.popContext=function(){this.pixelData=this.pixelStack.pop();return this.currentLayer=this.layerStack.pop();};Caman.prototype.applyCurrentLayer=function(){return this.currentLayer.applyToParent();};return Caman;})();Analyze=(function(){function Analyze(c){this.c=c;}
Analyze.prototype.calculateLevels=function(){var i,levels,numPixels,_i,_j,_k,_ref;levels={r:{},g:{},b:{}};for(i=_i=0;_i<=255;i=++_i){levels.r[i]=0;levels.g[i]=0;levels.b[i]=0;}
for(i=_j=0,_ref=this.c.pixelData.length;_j<_ref;i=_j+=4){levels.r[this.c.pixelData[i]]++;levels.g[this.c.pixelData[i+1]]++;levels.b[this.c.pixelData[i+2]]++;}
numPixels=this.c.pixelData.length/4;for(i=_k=0;_k<=255;i=++_k){levels.r[i]/=numPixels;levels.g[i]/=numPixels;levels.b[i]/=numPixels;}
return levels;};return Analyze;})();Caman.DOMUpdated=function(){var img,imgs,parser,_i,_len,_results;imgs=document.querySelectorAll("img[data-caman]");if(!(imgs.length>0)){return;}
_results=[];for(_i=0,_len=imgs.length;_i<_len;_i++){img=imgs[_i];_results.push(parser=new CamanParser(img,function(){this.parse();return this.execute();}));}
return _results;};if(Caman.autoload){(function(){if(document.readyState==="complete"){return Caman.DOMUpdated();}else{return document.addEventListener("DOMContentLoaded",Caman.DOMUpdated,false);}})();}
CamanParser=(function(){var INST_REGEX;INST_REGEX="(\\w+)\\((.*?)\\)";function CamanParser(ele,ready){this.dataStr=ele.getAttribute('data-caman');this.caman=Caman(ele,ready.bind(this));}
CamanParser.prototype.parse=function(){var args,filter,func,inst,instFunc,m,r,unparsedInstructions,_i,_len,_ref,_results;this.ele=this.caman.canvas;r=new RegExp(INST_REGEX,'g');unparsedInstructions=this.dataStr.match(r);if(!(unparsedInstructions.length>0)){return;}
r=new RegExp(INST_REGEX);_results=[];for(_i=0,_len=unparsedInstructions.length;_i<_len;_i++){inst=unparsedInstructions[_i];_ref=inst.match(r),m=_ref[0],filter=_ref[1],args=_ref[2];instFunc=new Function("return function() {        this."+filter+"("+args+");      };");try{func=instFunc();_results.push(func.call(this.caman));}catch(e){_results.push(Log.debug(e));}}
return _results;};CamanParser.prototype.execute=function(){var ele;ele=this.ele;return this.caman.render(function(){return ele.parentNode.replaceChild(this.toImage(),ele);});};return CamanParser;})();Caman.Blender=Blender=(function(){function Blender(){}
Blender.blenders={};Blender.register=function(name,func){return this.blenders[name]=func;};Blender.execute=function(name,rgbaLayer,rgbaParent){return this.blenders[name](rgbaLayer,rgbaParent);};return Blender;})();Caman.Calculate=Calculate=(function(){function Calculate(){}
Calculate.distance=function(x1,y1,x2,y2){return Math.sqrt(Math.pow(x2-x1,2)+Math.pow(y2-y1,2));};Calculate.randomRange=function(min,max,getFloat){var rand;if(getFloat==null){getFloat=false;}
rand=min+(Math.random()*(max-min));if(getFloat){return rand.toFixed(getFloat);}else{return Math.round(rand);}};Calculate.luminance=function(rgba){return(0.299*rgba.r)+(0.587*rgba.g)+(0.114*rgba.b);};Calculate.bezier=function(start,ctrl1,ctrl2,end,lowBound,highBound){var Ax,Ay,Bx,By,Cx,Cy,bezier,curveX,curveY,i,j,leftCoord,rightCoord,t,x0,x1,x2,x3,y0,y1,y2,y3,_i,_j,_k,_ref,_ref1;x0=start[0];y0=start[1];x1=ctrl1[0];y1=ctrl1[1];x2=ctrl2[0];y2=ctrl2[1];x3=end[0];y3=end[1];bezier={};Cx=parseInt(3*(x1-x0),10);Bx=3*(x2-x1)-Cx;Ax=x3-x0-Cx-Bx;Cy=3*(y1-y0);By=3*(y2-y1)-Cy;Ay=y3-y0-Cy-By;for(i=_i=0;_i<1000;i=++_i){t=i/1000;curveX=Math.round((Ax*Math.pow(t,3))+(Bx*Math.pow(t,2))+(Cx*t)+x0);curveY=Math.round((Ay*Math.pow(t,3))+(By*Math.pow(t,2))+(Cy*t)+y0);if(lowBound&&curveY<lowBound){curveY=lowBound;}else if(highBound&&curveY>highBound){curveY=highBound;}
bezier[curveX]=curveY;}
if(bezier.length<end[0]+1){for(i=_j=0,_ref=end[0];0<=_ref?_j<=_ref:_j>=_ref;i=0<=_ref?++_j:--_j){if(bezier[i]==null){leftCoord=[i-1,bezier[i-1]];for(j=_k=i,_ref1=end[0];i<=_ref1?_k<=_ref1:_k>=_ref1;j=i<=_ref1?++_k:--_k){if(bezier[j]!=null){rightCoord=[j,bezier[j]];break;}}
bezier[i]=leftCoord[1]+((rightCoord[1]-leftCoord[1])/(rightCoord[0]-leftCoord[0]))*(i-leftCoord[0]);}}}
if(bezier[end[0]]==null){bezier[end[0]]=bezier[end[0]-1];}
return bezier;};return Calculate;})();Convert=(function(){function Convert(){}
Convert.hexToRGB=function(hex){var b,g,r;if(hex.charAt(0)==="#"){hex=hex.substr(1);}
r=parseInt(hex.substr(0,2),16);g=parseInt(hex.substr(2,2),16);b=parseInt(hex.substr(4,2),16);return{r:r,g:g,b:b};};Convert.rgbToHSL=function(r,g,b){var d,h,l,max,min,s;if(typeof r==="object"){g=r.g;b=r.b;r=r.r;}
r/=255;g/=255;b/=255;max=Math.max(r,g,b);min=Math.min(r,g,b);l=(max+min)/2;if(max===min){h=s=0;}else{d=max-min;s=l>0.5?d/(2-max-min):d/(max+min);h=(function(){switch(max){case r:return(g-b)/d+(g<b?6:0);case g:return(b-r)/d+2;case b:return(r-g)/d+4;}})();h/=6;}
return{h:h,s:s,l:l};};Convert.hslToRGB=function(h,s,l){var b,g,p,q,r;if(typeof h==="object"){s=h.s;l=h.l;h=h.h;}
if(s===0){r=g=b=l;}else{q=l<0.5?l*(1+s):l+s-l*s;p=2*l-q;r=this.hueToRGB(p,q,h+1/3);g=this.hueToRGB(p,q,h);b=this.hueToRGB(p,q,h-1/3);}
return{r:r*255,g:g*255,b:b*255};};Convert.hueToRGB=function(p,q,t){if(t<0){t+=1;}
if(t>1){t-=1;}
if(t<1/6){return p+(q-p)*6*t;}
if(t<1/2){return q;}
if(t<2/3){return p+(q-p)*(2/3-t)*6;}
return p;};Convert.rgbToHSV=function(r,g,b){var d,h,max,min,s,v;r/=255;g/=255;b/=255;max=Math.max(r,g,b);min=Math.min(r,g,b);v=max;d=max-min;s=max===0?0:d/max;if(max===min){h=0;}else{h=(function(){switch(max){case r:return(g-b)/d+(g<b?6:0);case g:return(b-r)/d+2;case b:return(r-g)/d+4;}})();h/=6;}
return{h:h,s:s,v:v};};Convert.hsvToRGB=function(h,s,v){var b,f,g,i,p,q,r,t;i=Math.floor(h*6);f=h*6-i;p=v*(1-s);q=v*(1-f*s);t=v*(1-(1-f)*s);switch(i%6){case 0:r=v;g=t;b=p;break;case 1:r=q;g=v;b=p;break;case 2:r=p;g=v;b=t;break;case 3:r=p;g=q;b=v;break;case 4:r=t;g=p;b=v;break;case 5:r=v;g=p;b=q;}
return{r:r*255,g:g*255,b:b*255};};Convert.rgbToXYZ=function(r,g,b){var x,y,z;r/=255;g/=255;b/=255;if(r>0.04045){r=Math.pow((r+0.055)/1.055,2.4);}else{r/=12.92;}
if(g>0.04045){g=Math.pow((g+0.055)/1.055,2.4);}else{g/=12.92;}
if(b>0.04045){b=Math.pow((b+0.055)/1.055,2.4);}else{b/=12.92;}
x=r*0.4124+g*0.3576+b*0.1805;y=r*0.2126+g*0.7152+b*0.0722;z=r*0.0193+g*0.1192+b*0.9505;return{x:x*100,y:y*100,z:z*100};};Convert.xyzToRGB=function(x,y,z){var b,g,r;x/=100;y/=100;z/=100;r=(3.2406*x)+(-1.5372*y)+(-0.4986*z);g=(-0.9689*x)+(1.8758*y)+(0.0415*z);b=(0.0557*x)+(-0.2040*y)+(1.0570*z);if(r>0.0031308){r=(1.055*Math.pow(r,0.4166666667))-0.055;}else{r*=12.92;}
if(g>0.0031308){g=(1.055*Math.pow(g,0.4166666667))-0.055;}else{g*=12.92;}
if(b>0.0031308){b=(1.055*Math.pow(b,0.4166666667))-0.055;}else{b*=12.92;}
return{r:r*255,g:g*255,b:b*255};};Convert.xyzToLab=function(x,y,z){var a,b,l,whiteX,whiteY,whiteZ;if(typeof x==="object"){y=x.y;z=x.z;x=x.x;}
whiteX=95.047;whiteY=100.0;whiteZ=108.883;x/=whiteX;y/=whiteY;z/=whiteZ;if(x>0.008856451679){x=Math.pow(x,0.3333333333);}else{x=(7.787037037*x)+0.1379310345;}
if(y>0.008856451679){y=Math.pow(y,0.3333333333);}else{y=(7.787037037*y)+0.1379310345;}
if(z>0.008856451679){z=Math.pow(z,0.3333333333);}else{z=(7.787037037*z)+0.1379310345;}
l=116*y-16;a=500*(x-y);b=200*(y-z);return{l:l,a:a,b:b};};Convert.labToXYZ=function(l,a,b){var x,y,z;if(typeof l==="object"){a=l.a;b=l.b;l=l.l;}
y=(l+16)/116;x=y+(a/500);z=y-(b/200);if(x>0.2068965517){x=x*x*x;}else{x=0.1284185493*(x-0.1379310345);}
if(y>0.2068965517){y=y*y*y;}else{y=0.1284185493*(y-0.1379310345);}
if(z>0.2068965517){z=z*z*z;}else{z=0.1284185493*(z-0.1379310345);}
return{x:x*95.047,y:y*100.0,z:z*108.883};};Convert.rgbToLab=function(r,g,b){var xyz;if(typeof r==="object"){g=r.g;b=r.b;r=r.r;}
xyz=this.rgbToXYZ(r,g,b);return this.xyzToLab(xyz);};Convert.labToRGB=function(l,a,b){};return Convert;})();Event=(function(){function Event(){}
Event.events={};Event.types=["processStart","processComplete","renderStart","renderFinished","blockStarted","blockFinished"];Event.trigger=function(target,type,data){var event,_i,_len,_ref,_results;if(this.events[type]&&this.events[type].length){_ref=this.events[type];_results=[];for(_i=0,_len=_ref.length;_i<_len;_i++){event=_ref[_i];if(event.target===null||target.id===event.target.id){_results.push(event.fn.call(target,data));}else{_results.push(void 0);}}
return _results;}};Event.listen=function(target,type,fn){var _fn,_type;if(typeof target==="string"){_type=target;_fn=type;target=null;type=_type;fn=_fn;}
if(__indexOf.call(this.types,type)<0){return false;}
if(!this.events[type]){this.events[type]=[];}
this.events[type].push({target:target,fn:fn});return true;};return Event;})();Caman.Event=Event;Caman.Filter=Filter=(function(){function Filter(){}
Filter.Type={Single:1,Kernel:2,LayerDequeue:3,LayerFinished:4,LoadOverlay:5,Plugin:6};Filter.register=function(name,filterFunc){return Caman.prototype[name]=filterFunc;};return Filter;})();Caman.IO=IO=(function(){function IO(){}
IO.domainRegex=/(?:(?:http|https):\/\/)((?:\w+)\.(?:(?:\w|\.)+))/;IO.isRemote=function(img){if(img==null){return false;}
if(this.corsEnabled(img)){return false;}
return this.isURLRemote(img.src);};IO.corsEnabled=function(img){var _ref;return(img.crossOrigin!=null)&&((_ref=img.crossOrigin.toLowerCase())==='anonymous'||_ref==='use-credentials');};IO.isURLRemote=function(url){var matches;matches=url.match(this.domainRegex);if(matches){return matches[1]!==document.domain;}else{return false;}};IO.remoteCheck=function(src){if(this.isURLRemote(src)){if(!Caman.remoteProxy.length){Log.info("Attempting to load a remote image without a configured proxy. URL: "+src);}else{if(Caman.isURLRemote(Caman.remoteProxy)){Log.info("Cannot use a remote proxy for loading images.");return;}
return""+Caman.remoteProxy+"?camanProxyUrl="+(encodeURIComponent(src));}}};IO.proxyUrl=function(src){return""+Caman.remoteProxy+"?"+Caman.proxyParam+"="+(encodeURIComponent(src));};IO.useProxy=function(lang){var langToExt;langToExt={ruby:'rb',python:'py',perl:'pl',javascript:'js'};lang=lang.toLowerCase();if(langToExt[lang]!=null){lang=langToExt[lang];}
return"proxies/caman_proxy."+lang;};return IO;})();Caman.prototype.save=function(){if(typeof exports!=="undefined"&&exports!==null){return this.nodeSave.apply(this,arguments);}else{return this.browserSave.apply(this,arguments);}};Caman.prototype.browserSave=function(type){var image;if(type==null){type="png";}
type=type.toLowerCase();image=this.toBase64(type).replace("image/"+type,"image/octet-stream");return document.location.href=image;};Caman.prototype.nodeSave=function(file,overwrite){var stats;if(overwrite==null){overwrite=true;}
try{stats=fs.statSync(file);if(stats.isFile()&&!overwrite){return false;}}catch(e){Log.debug("Creating output file "+file);}
return fs.writeFile(file,this.canvas.toBuffer(),function(){return Log.debug("Finished writing to "+file);});};Caman.prototype.toImage=function(type){var img;img=document.createElement('img');img.src=this.toBase64(type);img.width=this.dimensions.width;img.height=this.dimensions.height;if(window.devicePixelRatio){img.width/=window.devicePixelRatio;img.height/=window.devicePixelRatio;}
return img;};Caman.prototype.toBase64=function(type){if(type==null){type="png";}
type=type.toLowerCase();return this.canvas.toDataURL("image/"+type);};Layer=(function(){function Layer(c){this.c=c;this.filter=this.c;this.options={blendingMode:'normal',opacity:1.0};this.layerID=Util.uniqid.get();this.canvas=typeof exports!=="undefined"&&exports!==null?new Canvas():document.createElement('canvas');this.canvas.width=this.c.dimensions.width;this.canvas.height=this.c.dimensions.height;this.context=this.canvas.getContext('2d');this.context.createImageData(this.canvas.width,this.canvas.height);this.imageData=this.context.getImageData(0,0,this.canvas.width,this.canvas.height);this.pixelData=this.imageData.data;}
Layer.prototype.newLayer=function(cb){return this.c.newLayer.call(this.c,cb);};Layer.prototype.setBlendingMode=function(mode){this.options.blendingMode=mode;return this;};Layer.prototype.opacity=function(opacity){this.options.opacity=opacity/100;return this;};Layer.prototype.copyParent=function(){var i,parentData,_i,_ref;parentData=this.c.pixelData;for(i=_i=0,_ref=this.c.pixelData.length;_i<_ref;i=_i+=4){this.pixelData[i]=parentData[i];this.pixelData[i+1]=parentData[i+1];this.pixelData[i+2]=parentData[i+2];this.pixelData[i+3]=parentData[i+3];}
return this;};Layer.prototype.fillColor=function(){return this.c.fillColor.apply(this.c,arguments);};Layer.prototype.overlayImage=function(image){if(typeof image==="object"){image=image.src;}else if(typeof image==="string"&&image[0]==="#"){image=$(image).src;}
if(!image){return this;}
this.c.renderer.renderQueue.push({type:Filter.Type.LoadOverlay,src:image,layer:this});return this;};Layer.prototype.applyToParent=function(){var i,layerData,parentData,result,rgbaLayer,rgbaParent,_i,_ref,_results;parentData=this.c.pixelStack[this.c.pixelStack.length-1];layerData=this.c.pixelData;_results=[];for(i=_i=0,_ref=layerData.length;_i<_ref;i=_i+=4){rgbaParent={r:parentData[i],g:parentData[i+1],b:parentData[i+2],a:parentData[i+3]};rgbaLayer={r:layerData[i],g:layerData[i+1],b:layerData[i+2],a:layerData[i+3]};result=Blender.execute(this.options.blendingMode,rgbaLayer,rgbaParent);result.r=Util.clampRGB(result.r);result.g=Util.clampRGB(result.g);result.b=Util.clampRGB(result.b);if(result.a==null){result.a=rgbaLayer.a;}
parentData[i]=rgbaParent.r-((rgbaParent.r-result.r)*(this.options.opacity*(result.a/255)));parentData[i+1]=rgbaParent.g-((rgbaParent.g-result.g)*(this.options.opacity*(result.a/255)));_results.push(parentData[i+2]=rgbaParent.b-((rgbaParent.b-result.b)*(this.options.opacity*(result.a/255))));}
return _results;};return Layer;})();Logger=(function(){function Logger(){var name,_i,_len,_ref;_ref=['log','info','warn','error'];for(_i=0,_len=_ref.length;_i<_len;_i++){name=_ref[_i];this[name]=(function(name){return function(){var args;args=1<=arguments.length?__slice.call(arguments,0):[];if(!Caman.DEBUG){return;}
try{return console[name].apply(console,args);}catch(e){return console[name](args);}};})(name);}
this.debug=this.log;}
return Logger;})();Log=new Logger();PixelInfo=(function(){PixelInfo.coordinatesToLocation=function(x,y,width){return(y*width+x)*4;};PixelInfo.locationToCoordinates=function(loc,width){var x,y;y=Math.floor(loc/(width*4));x=(loc%(width*4))/4;return{x:x,y:y};};function PixelInfo(c){this.c=c;this.loc=0;}
PixelInfo.prototype.locationXY=function(){var x,y;y=this.c.dimensions.height-Math.floor(this.loc/(this.c.dimensions.width*4));x=(this.loc%(this.c.dimensions.width*4))/4;return{x:x,y:y};};PixelInfo.prototype.getPixelRelative=function(horiz,vert){var newLoc;newLoc=this.loc+(this.c.dimensions.width*4*(vert*-1))+(4*horiz);if(newLoc>this.c.pixelData.length||newLoc<0){return{r:0,g:0,b:0,a:0};}
return{r:this.c.pixelData[newLoc],g:this.c.pixelData[newLoc+1],b:this.c.pixelData[newLoc+2],a:this.c.pixelData[newLoc+3]};};PixelInfo.prototype.putPixelRelative=function(horiz,vert,rgba){var nowLoc;nowLoc=this.loc+(this.c.dimensions.width*4*(vert*-1))+(4*horiz);if(newLoc>this.c.pixelData.length||newLoc<0){return;}
this.c.pixelData[newLoc]=rgba.r;this.c.pixelData[newLoc+1]=rgba.g;this.c.pixelData[newLoc+2]=rgba.b;this.c.pixelData[newLoc+3]=rgba.a;return true;};PixelInfo.prototype.getPixel=function(x,y){var loc;loc=this.coordinatesToLocation(x,y,this.width);return{r:this.c.pixelData[loc],g:this.c.pixelData[loc+1],b:this.c.pixelData[loc+2],a:this.c.pixelData[loc+3]};};PixelInfo.prototype.putPixel=function(x,y,rgba){var loc;loc=this.coordinatesToLocation(x,y,this.width);this.c.pixelData[loc]=rgba.r;this.c.pixelData[loc+1]=rgba.g;this.c.pixelData[loc+2]=rgba.b;return this.c.pixelData[loc+3]=rgba.a;};return PixelInfo;})();Plugin=(function(){function Plugin(){}
Plugin.plugins={};Plugin.register=function(name,plugin){return this.plugins[name]=plugin;};Plugin.execute=function(context,name,args){return this.plugins[name].apply(context,args);};return Plugin;})();Caman.Plugin=Plugin;Caman.Renderer=Renderer=(function(){Renderer.Blocks=Caman.NodeJS?require('os').cpus().length:4;function Renderer(c){var _this=this;this.c=c;this.processNext=function(){return Renderer.prototype.processNext.apply(_this,arguments);};this.renderQueue=[];this.modPixelData=null;}
Renderer.prototype.add=function(job){if(job==null){return;}
return this.renderQueue.push(job);};Renderer.prototype.processNext=function(){var layer;if(this.renderQueue.length===0){Event.trigger(this,"renderFinished");if(this.finishedFn!=null){this.finishedFn.call(this.c);}
return this;}
this.currentJob=this.renderQueue.shift();switch(this.currentJob.type){case Filter.Type.LayerDequeue:layer=this.c.canvasQueue.shift();this.c.executeLayer(layer);return this.processNext();case Filter.Type.LayerFinished:this.c.applyCurrentLayer();this.c.popContext();return this.processNext();case Filter.Type.LoadOverlay:return this.loadOverlay(this.currentJob.layer,this.currentJob.src);case Filter.Type.Plugin:return this.executePlugin();default:return this.executeFilter();}};Renderer.prototype.execute=function(callback){this.finishedFn=callback;this.modPixelData=Util.dataArray(this.c.pixelData.length);return this.processNext();};Renderer.prototype.eachBlock=function(fn){var blockN,blockPixelLength,bnum,end,f,i,lastBlockN,n,start,_i,_ref,_results,_this=this;this.blocksDone=0;n=this.c.pixelData.length;blockPixelLength=Math.floor((n/4)/Renderer.Blocks);blockN=blockPixelLength*4;lastBlockN=blockN+((n/4)%Renderer.Blocks)*4;_results=[];for(i=_i=0,_ref=Renderer.Blocks;0<=_ref?_i<_ref:_i>_ref;i=0<=_ref?++_i:--_i){start=i*blockN;end=start+(i===Renderer.Blocks-1?lastBlockN:blockN);if(Caman.NodeJS){f=Fiber(function(){return fn.call(_this,i,start,end);});bnum=f.run();_results.push(this.blockFinished(bnum));}else{_results.push(setTimeout((function(i,start,end){return function(){return fn.call(_this,i,start,end);};})(i,start,end),0));}}
return _results;};Renderer.prototype.executeFilter=function(){Event.trigger(this.c,"processStart",this.currentJob);if(this.currentJob.type===Filter.Type.Single){return this.eachBlock(this.renderBlock);}else{return this.eachBlock(this.renderKernel);}};Renderer.prototype.executePlugin=function(){Log.debug("Executing plugin "+this.currentJob.plugin);Plugin.execute(this.c,this.currentJob.plugin,this.currentJob.args);Log.debug("Plugin "+this.currentJob.plugin+" finished!");return this.processNext();};Renderer.prototype.renderBlock=function(bnum,start,end){var data,i,pixelInfo,res,_i;Log.debug("Block #"+bnum+" - Filter: "+this.currentJob.name+", Start: "+start+", End: "+end);Event.trigger(this.c,"blockStarted",{blockNum:bnum,totalBlocks:Renderer.Blocks,startPixel:start,endPixel:end});data={r:0,g:0,b:0,a:0};pixelInfo=new PixelInfo(this.c);for(i=_i=start;_i<end;i=_i+=4){pixelInfo.loc=i;data.r=this.c.pixelData[i];data.g=this.c.pixelData[i+1];data.b=this.c.pixelData[i+2];data.a=this.c.pixelData[i+3];res=this.currentJob.processFn.call(pixelInfo,data);if(res.a==null){res.a=data.a;}
this.c.pixelData[i]=Util.clampRGB(res.r);this.c.pixelData[i+1]=Util.clampRGB(res.g);this.c.pixelData[i+2]=Util.clampRGB(res.b);this.c.pixelData[i+3]=Util.clampRGB(res.a);}
if(Caman.NodeJS){return Fiber["yield"](bnum);}else{return this.blockFinished(bnum);}};Renderer.prototype.renderKernel=function(bnum,start,end){var adjust,adjustSize,bias,builder,builderIndex,divisor,i,j,k,kernel,n,name,pixel,pixelInfo,res,_i,_j,_k;name=this.currentJob.name;bias=this.currentJob.bias;divisor=this.currentJob.divisor;n=this.c.pixelData.length;adjust=this.currentJob.adjust;adjustSize=Math.sqrt(adjust.length);kernel=[];Log.debug("Rendering kernel - Filter: "+this.currentJob.name);start=Math.max(start,this.c.dimensions.width*4*((adjustSize-1)/2));end=Math.min(end,n-(this.c.dimensions.width*4*((adjustSize-1)/2)));builder=(adjustSize-1)/2;pixelInfo=new PixelInfo(this.c);for(i=_i=start;_i<end;i=_i+=4){pixelInfo.loc=i;builderIndex=0;for(j=_j=-builder;-builder<=builder?_j<=builder:_j>=builder;j=-builder<=builder?++_j:--_j){for(k=_k=builder;builder<=-builder?_k<=-builder:_k>=-builder;k=builder<=-builder?++_k:--_k){pixel=pixelInfo.getPixelRelative(j,k);kernel[builderIndex*3]=pixel.r;kernel[builderIndex*3+1]=pixel.g;kernel[builderIndex*3+2]=pixel.b;builderIndex++;}}
res=this.processKernel(adjust,kernel,divisor,bias);this.modPixelData[i]=Util.clampRGB(res.r);this.modPixelData[i+1]=Util.clampRGB(res.g);this.modPixelData[i+2]=Util.clampRGB(res.b);this.modPixelData[i+3]=this.c.pixelData[i+3];}
if(Caman.NodeJS){return Fiber["yield"](bnum);}else{return this.blockFinished(bnum);}};Renderer.prototype.blockFinished=function(bnum){var i,_i,_ref;if(bnum>=0){Log.debug("Block #"+bnum+" finished! Filter: "+this.currentJob.name);}
this.blocksDone++;Event.trigger(this.c,"blockFinished",{blockNum:bnum,blocksFinished:this.blocksDone,totalBlocks:Renderer.Blocks});if(this.blocksDone===Renderer.Blocks){if(this.currentJob.type===Filter.Type.Kernel){for(i=_i=0,_ref=this.c.pixelData.length;0<=_ref?_i<_ref:_i>_ref;i=0<=_ref?++_i:--_i){this.c.pixelData[i]=this.modPixelData[i];}}
if(bnum>=0){Log.debug("Filter "+this.currentJob.name+" finished!");}
Event.trigger(this.c,"processComplete",this.currentJob);return this.processNext();}};Renderer.prototype.processKernel=function(adjust,kernel,divisor,bias){var i,val,_i,_ref;val={r:0,g:0,b:0};for(i=_i=0,_ref=adjust.length;0<=_ref?_i<_ref:_i>_ref;i=0<=_ref?++_i:--_i){val.r+=adjust[i]*kernel[i*3];val.g+=adjust[i]*kernel[i*3+1];val.b+=adjust[i]*kernel[i*3+2];}
val.r=(val.r/divisor)+bias;val.g=(val.g/divisor)+bias;val.b=(val.b/divisor)+bias;return val;};Renderer.prototype.loadOverlay=function(layer,src){var img,proxyUrl,_this=this;img=document.createElement('img');img.onload=function(){layer.context.drawImage(img,0,0,_this.c.dimensions.width,_this.c.dimensions.height);layer.imageData=layer.context.getImageData(0,0,_this.c.dimensions.width,_this.c.dimensions.height);layer.pixelData=layer.imageData.data;_this.c.pixelData=layer.pixelData;return _this.processNext();};proxyUrl=IO.remoteCheck(src);return img.src=proxyUrl!=null?proxyUrl:src;};return Renderer;})();Caman.Store=Store=(function(){function Store(){}
Store.items={};Store.has=function(search){return this.items[search]!=null;};Store.get=function(search){return this.items[search];};Store.put=function(name,obj){return this.items[name]=obj;};Store.execute=function(search,callback){var _this=this;setTimeout(function(){return callback.call(_this.get(search),_this.get(search));},0);return this.get(search);};Store.flush=function(name){if(name==null){name=false;}
if(name){return delete this.items[name];}else{return this.items={};}};return Store;})();Blender.register("normal",function(rgbaLayer,rgbaParent){return{r:rgbaLayer.r,g:rgbaLayer.g,b:rgbaLayer.b};});Blender.register("multiply",function(rgbaLayer,rgbaParent){return{r:(rgbaLayer.r*rgbaParent.r)/255,g:(rgbaLayer.g*rgbaParent.g)/255,b:(rgbaLayer.b*rgbaParent.b)/255};});Blender.register("screen",function(rgbaLayer,rgbaParent){return{r:255-(((255-rgbaLayer.r)*(255-rgbaParent.r))/255),g:255-(((255-rgbaLayer.g)*(255-rgbaParent.g))/255),b:255-(((255-rgbaLayer.b)*(255-rgbaParent.b))/255)};});Blender.register("overlay",function(rgbaLayer,rgbaParent){var result;result={};result.r=rgbaParent.r>128?255-2*(255-rgbaLayer.r)*(255-rgbaParent.r)/255:(rgbaParent.r*rgbaLayer.r*2)/255;result.g=rgbaParent.g>128?255-2*(255-rgbaLayer.g)*(255-rgbaParent.g)/255:(rgbaParent.g*rgbaLayer.g*2)/255;result.b=rgbaParent.b>128?255-2*(255-rgbaLayer.b)*(255-rgbaParent.b)/255:(rgbaParent.b*rgbaLayer.b*2)/255;return result;});Blender.register("difference",function(rgbaLayer,rgbaParent){return{r:rgbaLayer.r-rgbaParent.r,g:rgbaLayer.g-rgbaParent.g,b:rgbaLayer.b-rgbaParent.b};});Blender.register("addition",function(rgbaLayer,rgbaParent){return{r:rgbaParent.r+rgbaLayer.r,g:rgbaParent.g+rgbaLayer.g,b:rgbaParent.b+rgbaLayer.b};});Blender.register("exclusion",function(rgbaLayer,rgbaParent){return{r:128-2*(rgbaParent.r-128)*(rgbaLayer.r-128)/255,g:128-2*(rgbaParent.g-128)*(rgbaLayer.g-128)/255,b:128-2*(rgbaParent.b-128)*(rgbaLayer.b-128)/255};});Blender.register("softLight",function(rgbaLayer,rgbaParent){var result;result={};result.r=rgbaParent.r>128?255-((255-rgbaParent.r)*(255-(rgbaLayer.r-128)))/255:(rgbaParent.r*(rgbaLayer.r+128))/255;result.g=rgbaParent.g>128?255-((255-rgbaParent.g)*(255-(rgbaLayer.g-128)))/255:(rgbaParent.g*(rgbaLayer.g+128))/255;result.b=rgbaParent.b>128?255-((255-rgbaParent.b)*(255-(rgbaLayer.b-128)))/255:(rgbaParent.b*(rgbaLayer.b+128))/255;return result;});Blender.register("lighten",function(rgbaLayer,rgbaParent){return{r:rgbaParent.r>rgbaLayer.r?rgbaParent.r:rgbaLayer.r,g:rgbaParent.g>rgbaLayer.g?rgbaParent.g:rgbaLayer.g,b:rgbaParent.b>rgbaLayer.b?rgbaParent.b:rgbaLayer.b};});Blender.register("darken",function(rgbaLayer,rgbaParent){return{r:rgbaParent.r>rgbaLayer.r?rgbaLayer.r:rgbaParent.r,g:rgbaParent.g>rgbaLayer.g?rgbaLayer.g:rgbaParent.g,b:rgbaParent.b>rgbaLayer.b?rgbaLayer.b:rgbaParent.b};});Filter.register("fillColor",function(){var color;if(arguments.length===1){color=Convert.hexToRGB(arguments[0]);}else{color={r:arguments[0],g:arguments[1],b:arguments[2]};}
return this.process("fillColor",function(rgba){rgba.r=color.r;rgba.g=color.g;rgba.b=color.b;rgba.a=255;return rgba;});});Filter.register("brightness",function(adjust){adjust=Math.floor(255*(adjust/100));return this.process("brightness",function(rgba){rgba.r+=adjust;rgba.g+=adjust;rgba.b+=adjust;return rgba;});});Filter.register("saturation",function(adjust){adjust*=-0.01;return this.process("saturation",function(rgba){var max;max=Math.max(rgba.r,rgba.g,rgba.b);if(rgba.r!==max){rgba.r+=(max-rgba.r)*adjust;}
if(rgba.g!==max){rgba.g+=(max-rgba.g)*adjust;}
if(rgba.b!==max){rgba.b+=(max-rgba.b)*adjust;}
return rgba;});});Filter.register("vibrance",function(adjust){adjust*=-1;return this.process("vibrance",function(rgba){var amt,avg,max;max=Math.max(rgba.r,rgba.g,rgba.b);avg=(rgba.r+rgba.g+rgba.b)/3;amt=((Math.abs(max-avg)*2/255)*adjust)/100;if(rgba.r!==max){rgba.r+=(max-rgba.r)*amt;}
if(rgba.g!==max){rgba.g+=(max-rgba.g)*amt;}
if(rgba.b!==max){rgba.b+=(max-rgba.b)*amt;}
return rgba;});});Filter.register("greyscale",function(adjust){return this.process("greyscale",function(rgba){var avg;avg=Calculate.luminance(rgba);rgba.r=avg;rgba.g=avg;rgba.b=avg;return rgba;});});Filter.register("contrast",function(adjust){adjust=Math.pow((adjust+100)/100,2);return this.process("contrast",function(rgba){rgba.r/=255;rgba.r-=0.5;rgba.r*=adjust;rgba.r+=0.5;rgba.r*=255;rgba.g/=255;rgba.g-=0.5;rgba.g*=adjust;rgba.g+=0.5;rgba.g*=255;rgba.b/=255;rgba.b-=0.5;rgba.b*=adjust;rgba.b+=0.5;rgba.b*=255;return rgba;});});Filter.register("hue",function(adjust){return this.process("hue",function(rgba){var h,hsv,rgb;hsv=Convert.rgbToHSV(rgba.r,rgba.g,rgba.b);h=hsv.h*100;h+=Math.abs(adjust);h=h%100;h/=100;hsv.h=h;rgb=Convert.hsvToRGB(hsv.h,hsv.s,hsv.v);rgb.a=rgba.a;return rgb;});});Filter.register("colorize",function(){var level,rgb;if(arguments.length===2){rgb=Convert.hexToRGB(arguments[0]);level=arguments[1];}else if(arguments.length===4){rgb={r:arguments[0],g:arguments[1],b:arguments[2]};level=arguments[3];}
return this.process("colorize",function(rgba){rgba.r-=(rgba.r-rgb.r)*(level/100);rgba.g-=(rgba.g-rgb.g)*(level/100);rgba.b-=(rgba.b-rgb.b)*(level/100);return rgba;});});Filter.register("invert",function(){return this.process("invert",function(rgba){rgba.r=255-rgba.r;rgba.g=255-rgba.g;rgba.b=255-rgba.b;return rgba;});});Filter.register("sepia",function(adjust){if(adjust==null){adjust=100;}
adjust/=100;return this.process("sepia",function(rgba){rgba.r=Math.min(255,(rgba.r*(1-(0.607*adjust)))+(rgba.g*(0.769*adjust))+(rgba.b*(0.189*adjust)));rgba.g=Math.min(255,(rgba.r*(0.349*adjust))+(rgba.g*(1-(0.314*adjust)))+(rgba.b*(0.168*adjust)));rgba.b=Math.min(255,(rgba.r*(0.272*adjust))+(rgba.g*(0.534*adjust))+(rgba.b*(1-(0.869*adjust))));return rgba;});});Filter.register("gamma",function(adjust){return this.process("gamma",function(rgba){rgba.r=Math.pow(rgba.r/255,adjust)*255;rgba.g=Math.pow(rgba.g/255,adjust)*255;rgba.b=Math.pow(rgba.b/255,adjust)*255;return rgba;});});Filter.register("noise",function(adjust){adjust=Math.abs(adjust)*2.55;return this.process("noise",function(rgba){var rand;rand=Calculate.randomRange(adjust*-1,adjust);rgba.r+=rand;rgba.g+=rand;rgba.b+=rand;return rgba;});});Filter.register("clip",function(adjust){adjust=Math.abs(adjust)*2.55;return this.process("clip",function(rgba){if(rgba.r>255-adjust){rgba.r=255;}else if(rgba.r<adjust){rgba.r=0;}
if(rgba.g>255-adjust){rgba.g=255;}else if(rgba.g<adjust){rgba.g=0;}
if(rgba.b>255-adjust){rgba.b=255;}else if(rgba.b<adjust){rgba.b=0;}
return rgba;});});Filter.register("channels",function(options){var chan,value;if(typeof options!=="object"){return this;}
for(chan in options){if(!__hasProp.call(options,chan))continue;value=options[chan];if(value===0){delete options[chan];continue;}
options[chan]/=100;}
if(options.length===0){return this;}
return this.process("channels",function(rgba){if(options.red!=null){if(options.red>0){rgba.r+=(255-rgba.r)*options.red;}else{rgba.r-=rgba.r*Math.abs(options.red);}}
if(options.green!=null){if(options.green>0){rgba.g+=(255-rgba.g)*options.green;}else{rgba.g-=rgba.g*Math.abs(options.green);}}
if(options.blue!=null){if(options.blue>0){rgba.b+=(255-rgba.b)*options.blue;}else{rgba.b-=rgba.b*Math.abs(options.blue);}}
return rgba;});});Filter.register("curves",function(){var bezier,chans,cps,ctrl1,ctrl2,end,i,start,_i,_j,_ref,_ref1;chans=arguments[0],cps=2<=arguments.length?__slice.call(arguments,1):[];if(typeof chans==="string"){chans=chans.split("");}
if(chans[0]==="v"){chans=['r','g','b'];}
if(cps.length<3||cps.length>4){throw"Invalid number of arguments to curves filter";}
start=cps[0];ctrl1=cps[1];ctrl2=cps.length===4?cps[2]:cps[1];end=cps[cps.length-1];bezier=Calculate.bezier(start,ctrl1,ctrl2,end,0,255);if(start[0]>0){for(i=_i=0,_ref=start[0];0<=_ref?_i<_ref:_i>_ref;i=0<=_ref?++_i:--_i){bezier[i]=start[1];}}
if(end[0]<255){for(i=_j=_ref1=end[0];_ref1<=255?_j<=255:_j>=255;i=_ref1<=255?++_j:--_j){bezier[i]=end[1];}}
return this.process("curves",function(rgba){var _k,_ref2;for(i=_k=0,_ref2=chans.length;0<=_ref2?_k<_ref2:_k>_ref2;i=0<=_ref2?++_k:--_k){rgba[chans[i]]=bezier[rgba[chans[i]]];}
return rgba;});});Filter.register("exposure",function(adjust){var ctrl1,ctrl2,p;p=Math.abs(adjust)/100;ctrl1=[0,255*p];ctrl2=[255-(255*p),255];if(adjust<0){ctrl1=ctrl1.reverse();ctrl2=ctrl2.reverse();}
return this.curves('rgb',[0,0],ctrl1,ctrl2,[255,255]);});Caman.Plugin.register("crop",function(width,height,x,y){var canvas,ctx;if(x==null){x=0;}
if(y==null){y=0;}
if(typeof exports!=="undefined"&&exports!==null){canvas=new Canvas(width,height);}else{canvas=document.createElement('canvas');Util.copyAttributes(this.canvas,canvas);canvas.width=width;canvas.height=height;}
ctx=canvas.getContext('2d');ctx.drawImage(this.canvas,x,y,width,height,0,0,width,height);this.cropCoordinates={x:x,y:y};this.cropped=true;return this.replaceCanvas(canvas);});Caman.Plugin.register("resize",function(newDims){var canvas,ctx;if(newDims==null){newDims=null;}
if(newDims===null||((newDims.width==null)&&(newDims.height==null))){Log.error("Invalid or missing dimensions given for resize");return;}
if(newDims.width==null){newDims.width=this.canvas.width*newDims.height/this.canvas.height;}else if(newDims.height==null){newDims.height=this.canvas.height*newDims.width/this.canvas.width;}
if(typeof exports!=="undefined"&&exports!==null){canvas=new Canvas(newDims.width,newDims.height);}else{canvas=document.createElement('canvas');Util.copyAttributes(this.canvas,canvas);canvas.width=newDims.width;canvas.height=newDims.height;}
ctx=canvas.getContext('2d');ctx.drawImage(this.canvas,0,0,this.canvas.width,this.canvas.height,0,0,newDims.width,newDims.height);this.resized=true;return this.replaceCanvas(canvas);});Caman.Filter.register("crop",function(){return this.processPlugin("crop",Array.prototype.slice.call(arguments,0));});Caman.Filter.register("resize",function(){return this.processPlugin("resize",Array.prototype.slice.call(arguments,0));});Caman.Filter.register("boxBlur",function(){return this.processKernel("Box Blur",[1,1,1,1,1,1,1,1,1]);});Caman.Filter.register("heavyRadialBlur",function(){return this.processKernel("Heavy Radial Blur",[0,0,1,0,0,0,1,1,1,0,1,1,1,1,1,0,1,1,1,0,0,0,1,0,0]);});Caman.Filter.register("gaussianBlur",function(){return this.processKernel("Gaussian Blur",[1,4,6,4,1,4,16,24,16,4,6,24,36,24,6,4,16,24,16,4,1,4,6,4,1]);});Caman.Filter.register("motionBlur",function(degrees){var kernel;if(degrees===0||degrees===180){kernel=[0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0];}else if((degrees>0&&degrees<90)||(degrees>180&&degrees<270)){kernel=[0,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,0];}else if(degrees===90||degrees===270){kernel=[0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0];}else{kernel=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1];}
return this.processKernel("Motion Blur",kernel);});Caman.Filter.register("sharpen",function(amt){if(amt==null){amt=100;}
amt/=100;return this.processKernel("Sharpen",[0,-amt,0,-amt,4*amt+1,-amt,0,-amt,0]);});vignetteFilters={brightness:function(rgba,amt,opts){rgba.r=rgba.r-(rgba.r*amt*opts.strength);rgba.g=rgba.g-(rgba.g*amt*opts.strength);rgba.b=rgba.b-(rgba.b*amt*opts.strength);return rgba;},gamma:function(rgba,amt,opts){rgba.r=Math.pow(rgba.r/255,Math.max(10*amt*opts.strength,1))*255;rgba.g=Math.pow(rgba.g/255,Math.max(10*amt*opts.strength,1))*255;rgba.b=Math.pow(rgba.b/255,Math.max(10*amt*opts.strength,1))*255;return rgba;},colorize:function(rgba,amt,opts){rgba.r-=(rgba.r-opts.color.r)*amt;rgba.g-=(rgba.g-opts.color.g)*amt;rgba.b-=(rgba.b-opts.color.b)*amt;return rgba;}};Filter.register("vignette",function(size,strength){var bezier,center,end,start;if(strength==null){strength=60;}
if(typeof size==="string"&&size.substr(-1)==="%"){if(this.dimensions.height>this.dimensions.width){size=this.dimensions.width*(parseInt(size.substr(0,size.length-1),10)/100);}else{size=this.dimensions.height*(parseInt(size.substr(0,size.length-1),10)/100);}}
strength/=100;center=[this.dimensions.width/2,this.dimensions.height/2];start=Math.sqrt(Math.pow(center[0],2)+Math.pow(center[1],2));end=start-size;bezier=Calculate.bezier([0,1],[30,30],[70,60],[100,80]);return this.process("vignette",function(rgba){var dist,div,loc;loc=this.locationXY();dist=Calculate.distance(loc.x,loc.y,center[0],center[1]);if(dist>end){div=Math.max(1,(bezier[Math.round(((dist-end)/size)*100)]/10)*strength);rgba.r=Math.pow(rgba.r/255,div)*255;rgba.g=Math.pow(rgba.g/255,div)*255;rgba.b=Math.pow(rgba.b/255,div)*255;}
return rgba;});});Filter.register("rectangularVignette",function(opts){var defaults,dim,percent,size,_i,_len,_ref;defaults={strength:50,cornerRadius:0,method:'brightness',color:{r:0,g:0,b:0}};opts=Util.extend(defaults,opts);if(!opts.size){return this;}else if(typeof opts.size==="string"){percent=parseInt(opts.size,10)/100;opts.size={width:this.dimensions.width*percent,height:this.dimensions.height*percent};}else if(typeof opts.size==="object"){_ref=["width","height"];for(_i=0,_len=_ref.length;_i<_len;_i++){dim=_ref[_i];if(typeof opts.size[dim]==="string"){opts.size[dim]=this.dimensions[dim]*(parseInt(opts.size[dim],10)/100);}}}else if(opts.size==="number"){size=opts.size;opts.size={width:size,height:size};}
if(typeof opts.cornerRadius==="string"){opts.cornerRadius=(opts.size.width/2)*(parseInt(opts.cornerRadius,10)/100);}
opts.strength/=100;opts.size.width=Math.floor(opts.size.width);opts.size.height=Math.floor(opts.size.height);opts.image={width:this.dimensions.width,height:this.dimensions.height};if(opts.method==="colorize"&&typeof opts.color==="string"){opts.color=Convert.hexToRGB(opts.color);}
opts.coords={left:(this.dimensions.width-opts.size.width)/2,right:this.dimensions.width-opts.coords.left,bottom:(this.dimensions.height-opts.size.height)/2,top:this.dimensions.height-opts.coords.bottom};opts.corners=[{x:opts.coords.left+opts.cornerRadius,y:opts.coords.top-opts.cornerRadius},{x:opts.coords.right-opts.cornerRadius,y:opts.coords.top-opts.cornerRadius},{x:opts.coords.right-opts.cornerRadius,y:opts.coords.bottom+opts.cornerRadius},{x:opts.coords.left+opts.cornerRadius,y:opts.coords.bottom+opts.cornerRadius}];opts.maxDist=Calculate.distance(0,0,opts.corners[3].x,opts.corners[3].y)-opts.cornerRadius;return this.process("rectangularVignette",function(rgba){var amt,loc,radialDist;loc=this.locationXY();if((loc.x>opts.corners[0].x&&loc.x<opts.corners[1].x)&&(loc.y>opts.coords.bottom&&loc.y<opts.coords.top)){return rgba;}
if((loc.x>opts.coords.left&&loc.x<opts.coords.right)&&(loc.y>opts.corners[3].y&&loc.y<opts.corners[2].y)){return rgba;}
if(loc.x>opts.corners[0].x&&loc.x<opts.corners[1].x&&loc.y>opts.coords.top){amt=(loc.y-opts.coords.top)/opts.maxDist;}else if(loc.y>opts.corners[2].y&&loc.y<opts.corners[1].y&&loc.x>opts.coords.right){amt=(loc.x-opts.coords.right)/opts.maxDist;}else if(loc.x>opts.corners[0].x&&loc.x<opts.corners[1].x&&loc.y<opts.coords.bottom){amt=(opts.coords.bottom-loc.y)/opts.maxDist;}else if(loc.y>opts.corners[2].y&&loc.y<opts.corners[1].y&&loc.x<opts.coords.left){amt=(opts.coords.left-loc.x)/opts.maxDist;}else if(loc.x<=opts.corners[0].x&&loc.y>=opts.corners[0].y){radialDist=Caman.distance(loc.x,loc.y,opts.corners[0].x,opts.corners[0].y);amt=(radialDist-opts.cornerRadius)/opts.maxDist;}else if(loc.x>=opts.corners[1].x&&loc.y>=opts.corners[1].y){radialDist=Caman.distance(loc.x,loc.y,opts.corners[1].x,opts.corners[1].y);amt=(radialDist-opts.cornerRadius)/opts.maxDist;}else if(loc.x>=opts.corners[2].x&&loc.y<=opts.corners[2].y){radialDist=Caman.distance(loc.x,loc.y,opts.corners[2].x,opts.corners[2].y);amt=(radialDist-opts.cornerRadius)/opts.maxDist;}else if(loc.x<=opts.corners[3].x&&loc.y<=opts.corners[3].y){radialDist=Caman.distance(loc.x,loc.y,opts.corners[3].x,opts.corners[3].y);amt=(radialDist-opts.cornerRadius)/opts.maxDist;}
if(amt<0){return rgba;}
return vignetteFilters[opts.method](rgba,amt,opts);});});(function(){var BlurStack,getLinearGradientMap,getRadialGradientMap,mul_table,shg_table;mul_table=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259];shg_table=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24];getLinearGradientMap=function(width,height,centerX,centerY,angle,length,mirrored){var cnv,context,gradient,x1,x2,y1,y2;cnv=typeof exports!=="undefined"&&exports!==null?new Canvas():document.createElement('canvas');cnv.width=width;cnv.height=height;x1=centerX+Math.cos(angle)*length*0.5;y1=centerY+Math.sin(angle)*length*0.5;x2=centerX-Math.cos(angle)*length*0.5;y2=centerY-Math.sin(angle)*length*0.5;context=cnv.getContext("2d");gradient=context.createLinearGradient(x1,y1,x2,y2);if(!mirrored){gradient.addColorStop(0,"white");gradient.addColorStop(1,"black");}else{gradient.addColorStop(0,"white");gradient.addColorStop(0.5,"black");gradient.addColorStop(1,"white");}
context.fillStyle=gradient;context.fillRect(0,0,width,height);return context.getImageData(0,0,width,height);};getRadialGradientMap=function(width,height,centerX,centerY,radius1,radius2){var cnv,context,gradient;cnv=typeof exports!=="undefined"&&exports!==null?new Canvas():document.createElement('canvas');cnv.width=width;cnv.height=height;context=cnv.getContext("2d");gradient=context.createRadialGradient(centerX,centerY,radius1,centerX,centerY,radius2);gradient.addColorStop(1,"white");gradient.addColorStop(0,"black");context.fillStyle=gradient;context.fillRect(0,0,width,height);return context.getImageData(0,0,width,height);};BlurStack=function(){this.r=0;this.g=0;this.b=0;this.a=0;return this.next=null;};Caman.Plugin.register("compoundBlur",function(radiusData,radius,increaseFactor,blurLevels){var b_in_sum,b_out_sum,b_sum,blend,currentIndex,div,g_in_sum,g_out_sum,g_sum,height,heightMinus1,i,iblend,idx,imagePixels,index,iradius,lookupValue,mul_sum,p,pb,pg,pixels,pr,r_in_sum,r_out_sum,r_sum,radiusPixels,radiusPlus1,rbs,shg_sum,stack,stackEnd,stackIn,stackOut,stackStart,steps,sumFactor,w4,wh,wh4,width,widthMinus1,x,y,yi,yp,yw,_i,_j,_k,_l,_m,_n,_o,_p,_q,_r;width=this.dimensions.width;height=this.dimensions.height;imagePixels=this.pixelData;radiusPixels=radiusData.data;wh=width*height;wh4=wh<<2;pixels=[];for(i=_i=0;0<=wh4?_i<wh4:_i>wh4;i=0<=wh4?++_i:--_i){pixels[i]=imagePixels[i];}
currentIndex=0;steps=blurLevels;blurLevels-=1;while(steps-->=0){iradius=(radius+0.5)|0;if(iradius===0){continue;}
if(iradius>256){iradius=256;}
div=iradius+iradius+1;w4=width<<2;widthMinus1=width-1;heightMinus1=height-1;radiusPlus1=iradius+1;sumFactor=radiusPlus1*(radiusPlus1+1)/2;stackStart=new BlurStack();stackEnd=void 0;stack=stackStart;for(i=_j=1;1<=div?_j<div:_j>div;i=1<=div?++_j:--_j){stack=stack.next=new BlurStack();if(i===radiusPlus1){stackEnd=stack;}}
stack.next=stackStart;stackIn=null;stackOut=null;yw=yi=0;mul_sum=mul_table[iradius];shg_sum=shg_table[iradius];for(y=_k=0;0<=height?_k<height:_k>height;y=0<=height?++_k:--_k){r_in_sum=g_in_sum=b_in_sum=r_sum=g_sum=b_sum=0;r_out_sum=radiusPlus1*(pr=pixels[yi]);g_out_sum=radiusPlus1*(pg=pixels[yi+1]);b_out_sum=radiusPlus1*(pb=pixels[yi+2]);r_sum+=sumFactor*pr;g_sum+=sumFactor*pg;b_sum+=sumFactor*pb;stack=stackStart;for(i=_l=0;0<=radiusPlus1?_l<radiusPlus1:_l>radiusPlus1;i=0<=radiusPlus1?++_l:--_l){stack.r=pr;stack.g=pg;stack.b=pb;stack=stack.next;}
for(i=_m=1;1<=radiusPlus1?_m<radiusPlus1:_m>radiusPlus1;i=1<=radiusPlus1?++_m:--_m){p=yi+((widthMinus1<i?widthMinus1:i)<<2);r_sum+=(stack.r=(pr=pixels[p]))*(rbs=radiusPlus1-i);g_sum+=(stack.g=(pg=pixels[p+1]))*rbs;b_sum+=(stack.b=(pb=pixels[p+2]))*rbs;r_in_sum+=pr;g_in_sum+=pg;b_in_sum+=pb;stack=stack.next;}
stackIn=stackStart;stackOut=stackEnd;for(x=_n=0;0<=width?_n<width:_n>width;x=0<=width?++_n:--_n){pixels[yi]=(r_sum*mul_sum)>>shg_sum;pixels[yi+1]=(g_sum*mul_sum)>>shg_sum;pixels[yi+2]=(b_sum*mul_sum)>>shg_sum;r_sum-=r_out_sum;g_sum-=g_out_sum;b_sum-=b_out_sum;r_out_sum-=stackIn.r;g_out_sum-=stackIn.g;b_out_sum-=stackIn.b;p=(yw+((p=x+radiusPlus1)<widthMinus1?p:widthMinus1))<<2;r_in_sum+=(stackIn.r=pixels[p]);g_in_sum+=(stackIn.g=pixels[p+1]);b_in_sum+=(stackIn.b=pixels[p+2]);r_sum+=r_in_sum;g_sum+=g_in_sum;b_sum+=b_in_sum;stackIn=stackIn.next;r_out_sum+=(pr=stackOut.r);g_out_sum+=(pg=stackOut.g);b_out_sum+=(pb=stackOut.b);r_in_sum-=pr;g_in_sum-=pg;b_in_sum-=pb;stackOut=stackOut.next;yi+=4;}
yw+=width;}
for(x=_o=0;0<=width?_o<width:_o>width;x=0<=width?++_o:--_o){g_in_sum=b_in_sum=r_in_sum=g_sum=b_sum=r_sum=0;yi=x<<2;r_out_sum=radiusPlus1*(pr=pixels[yi]);g_out_sum=radiusPlus1*(pg=pixels[yi+1]);b_out_sum=radiusPlus1*(pb=pixels[yi+2]);r_sum+=sumFactor*pr;g_sum+=sumFactor*pg;b_sum+=sumFactor*pb;stack=stackStart;for(i=_p=0;0<=radiusPlus1?_p<radiusPlus1:_p>radiusPlus1;i=0<=radiusPlus1?++_p:--_p){stack.r=pr;stack.g=pg;stack.b=pb;stack=stack.next;}
yp=width;for(i=_q=1;1<=radiusPlus1?_q<radiusPlus1:_q>radiusPlus1;i=1<=radiusPlus1?++_q:--_q){yi=(yp+x)<<2;r_sum+=(stack.r=(pr=pixels[yi]))*(rbs=radiusPlus1-i);g_sum+=(stack.g=(pg=pixels[yi+1]))*rbs;b_sum+=(stack.b=(pb=pixels[yi+2]))*rbs;r_in_sum+=pr;g_in_sum+=pg;b_in_sum+=pb;stack=stack.next;if(i<heightMinus1){yp+=width;}}
yi=x;stackIn=stackStart;stackOut=stackEnd;for(y=_r=0;0<=height?_r<height:_r>height;y=0<=height?++_r:--_r){p=yi<<2;pixels[p]=(r_sum*mul_sum)>>shg_sum;pixels[p+1]=(g_sum*mul_sum)>>shg_sum;pixels[p+2]=(b_sum*mul_sum)>>shg_sum;r_sum-=r_out_sum;g_sum-=g_out_sum;b_sum-=b_out_sum;r_out_sum-=stackIn.r;g_out_sum-=stackIn.g;b_out_sum-=stackIn.b;p=(x+(((p=y+radiusPlus1)<heightMinus1?p:heightMinus1)*width))<<2;r_sum+=(r_in_sum+=(stackIn.r=pixels[p]));g_sum+=(g_in_sum+=(stackIn.g=pixels[p+1]));b_sum+=(b_in_sum+=(stackIn.b=pixels[p+2]));stackIn=stackIn.next;r_out_sum+=(pr=stackOut.r);g_out_sum+=(pg=stackOut.g);b_out_sum+=(pb=stackOut.b);r_in_sum-=pr;g_in_sum-=pg;b_in_sum-=pb;stackOut=stackOut.next;yi+=width;}}
radius*=increaseFactor;i=wh;while(--i>-1){idx=i<<2;lookupValue=(radiusPixels[idx+2]&0xff)/255.0*blurLevels;index=lookupValue|0;if(index===currentIndex){blend=256.0*(lookupValue-(lookupValue|0));iblend=256-blend;imagePixels[idx]=(imagePixels[idx]*iblend+pixels[idx]*blend)>>8;imagePixels[idx+1]=(imagePixels[idx+1]*iblend+pixels[idx+1]*blend)>>8;imagePixels[idx+2]=(imagePixels[idx+2]*iblend+pixels[idx+2]*blend)>>8;}else if(index===currentIndex+1){imagePixels[idx]=pixels[idx];imagePixels[idx+1]=pixels[idx+1];imagePixels[idx+2]=pixels[idx+2];}}
currentIndex++;}
return this;});Caman.Filter.register("tiltShift",function(opts){var defaults,gradient;defaults={center:{x:this.dimensions.width/2,y:this.dimensions.height/2},angle:45,focusWidth:200,startRadius:3,radiusFactor:1.5,steps:3};opts=Util.extend(defaults,opts);opts.angle*=Math.PI/180;gradient=getLinearGradientMap(this.dimensions.width,this.dimensions.height,opts.center.x,opts.center.y,opts.angle,opts.focusWidth,true);return this.processPlugin("compoundBlur",[gradient,opts.startRadius,opts.radiusFactor,opts.steps]);});return Caman.Filter.register("radialBlur",function(opts){var defaults,gradient,radius1,radius2;defaults={size:50,center:{x:this.dimensions.width/2,y:this.dimensions.height/2},startRadius:3,radiusFactor:1.5,steps:3,radius:null};opts=Util.extend(defaults,opts);if(!opts.radius){opts.radius=this.dimensions.width<this.dimensions.height?this.dimensions.height:this.dimensions.width;}
radius1=(opts.radius/2)-opts.size;radius2=opts.radius/2;gradient=getRadialGradientMap(this.dimensions.width,this.dimensions.height,opts.center.x,opts.center.y,radius1,radius2);return this.processPlugin("compoundBlur",[gradient,opts.startRadius,opts.radiusFactor,opts.steps]);});})();Caman.Filter.register("edgeEnhance",function(){return this.processKernel("Edge Enhance",[0,0,0,-1,1,0,0,0,0]);});Caman.Filter.register("edgeDetect",function(){return this.processKernel("Edge Detect",[-1,-1,-1,-1,8,-1,-1,-1,-1]);});Caman.Filter.register("emboss",function(){return this.processKernel("Emboss",[-2,-1,0,-1,1,1,0,1,2]);});Caman.Filter.register("posterize",function(adjust){var numOfAreas,numOfValues;numOfAreas=256/adjust;numOfValues=255/(adjust-1);return this.process("posterize",function(rgba){rgba.r=Math.floor(Math.floor(rgba.r/numOfAreas)*numOfValues);rgba.g=Math.floor(Math.floor(rgba.g/numOfAreas)*numOfValues);rgba.b=Math.floor(Math.floor(rgba.b/numOfAreas)*numOfValues);return rgba;});});Caman.Filter.register("vintage",function(vignette){if(vignette==null){vignette=true;}
this.greyscale();this.contrast(5);this.noise(3);this.sepia(100);this.channels({red:8,blue:2,green:4});this.gamma(0.87);if(vignette){return this.vignette("40%",30);}});Caman.Filter.register("lomo",function(vignette){if(vignette==null){vignette=true;}
this.brightness(15);this.exposure(15);this.curves('rgb',[0,0],[200,0],[155,255],[255,255]);this.saturation(-20);this.gamma(1.8);if(vignette){this.vignette("50%",60);}
return this.brightness(5);});Caman.Filter.register("clarity",function(grey){if(grey==null){grey=false;}
this.vibrance(20);this.curves('rgb',[5,0],[130,150],[190,220],[250,255]);this.sharpen(15);this.vignette("45%",20);if(grey){this.greyscale();this.contrast(4);}
return this;});Caman.Filter.register("sinCity",function(){this.contrast(100);this.brightness(15);this.exposure(10);this.posterize(80);this.clip(30);return this.greyscale();});Caman.Filter.register("sunrise",function(){this.exposure(3.5);this.saturation(-5);this.vibrance(50);this.sepia(60);this.colorize("#e87b22",10);this.channels({red:8,blue:8});this.contrast(5);this.gamma(1.2);return this.vignette("55%",25);});Caman.Filter.register("crossProcess",function(){this.exposure(5);this.colorize("#e87b22",4);this.sepia(20);this.channels({blue:8,red:3});this.curves('b',[0,0],[100,150],[180,180],[255,255]);this.contrast(15);this.vibrance(75);return this.gamma(1.6);});Caman.Filter.register("orangePeel",function(){this.curves('rgb',[0,0],[100,50],[140,200],[255,255]);this.vibrance(-30);this.saturation(-30);this.colorize('#ff9000',30);this.contrast(-5);return this.gamma(1.4);});Caman.Filter.register("love",function(){this.brightness(5);this.exposure(8);this.contrast(4);this.colorize('#c42007',30);this.vibrance(50);return this.gamma(1.3);});Caman.Filter.register("grungy",function(){this.gamma(1.5);this.clip(25);this.saturation(-60);this.contrast(5);this.noise(5);return this.vignette("50%",30);});Caman.Filter.register("jarques",function(){this.saturation(-35);this.curves('b',[20,0],[90,120],[186,144],[255,230]);this.curves('r',[0,0],[144,90],[138,120],[255,255]);this.curves('g',[10,0],[115,105],[148,100],[255,248]);this.curves('rgb',[0,0],[120,100],[128,140],[255,255]);return this.sharpen(20);});Caman.Filter.register("pinhole",function(){this.greyscale();this.sepia(10);this.exposure(10);this.contrast(15);return this.vignette("60%",35);});Caman.Filter.register("oldBoot",function(){this.saturation(-20);this.vibrance(-50);this.gamma(1.1);this.sepia(30);this.channels({red:-10,blue:5});this.curves('rgb',[0,0],[80,50],[128,230],[255,255]);return this.vignette("60%",30);});Caman.Filter.register("glowingSun",function(vignette){if(vignette==null){vignette=true;}
this.brightness(10);this.newLayer(function(){this.setBlendingMode("multiply");this.opacity(80);this.copyParent();this.filter.gamma(0.8);this.filter.contrast(50);return this.filter.exposure(10);});this.newLayer(function(){this.setBlendingMode("softLight");this.opacity(80);return this.fillColor("#f49600");});this.exposure(20);this.gamma(0.8);if(vignette){return this.vignette("45%",20);}});Caman.Filter.register("hazyDays",function(){this.gamma(1.2);this.newLayer(function(){this.setBlendingMode("overlay");this.opacity(60);this.copyParent();this.filter.channels({red:5});return this.filter.stackBlur(15);});this.newLayer(function(){this.setBlendingMode("addition");this.opacity(40);return this.fillColor("#6899ba");});this.newLayer(function(){this.setBlendingMode("multiply");this.opacity(35);this.copyParent();this.filter.brightness(40);this.filter.vibrance(40);this.filter.exposure(30);this.filter.contrast(15);this.filter.curves('r',[0,40],[128,128],[128,128],[255,215]);this.filter.curves('g',[0,40],[128,128],[128,128],[255,215]);this.filter.curves('b',[0,40],[128,128],[128,128],[255,215]);return this.filter.stackBlur(5);});this.curves('r',[20,0],[128,158],[128,128],[235,255]);this.curves('g',[20,0],[128,128],[128,128],[235,255]);this.curves('b',[20,0],[128,108],[128,128],[235,255]);return this.vignette("45%",20);});Caman.Filter.register("herMajesty",function(){this.brightness(40);this.colorize("#ea1c5d",10);this.curves('b',[0,10],[128,180],[190,190],[255,255]);this.newLayer(function(){this.setBlendingMode('overlay');this.opacity(50);this.copyParent();this.filter.gamma(0.7);return this.newLayer(function(){this.setBlendingMode('normal');this.opacity(60);return this.fillColor('#ea1c5d');});});this.newLayer(function(){this.setBlendingMode('multiply');this.opacity(60);this.copyParent();this.filter.saturation(50);this.filter.hue(90);return this.filter.contrast(10);});this.gamma(1.4);this.vibrance(-30);this.newLayer(function(){this.opacity(10);return this.fillColor('#e5f0ff');});return this;});Caman.Filter.register("nostalgia",function(){this.saturation(20);this.gamma(1.4);this.greyscale();this.contrast(5);this.sepia(100);this.channels({red:8,blue:2,green:4});this.gamma(0.8);this.contrast(5);this.exposure(10);this.newLayer(function(){this.setBlendingMode('overlay');this.copyParent();this.opacity(55);return this.filter.stackBlur(10);});return this.vignette("50%",30);});Caman.Filter.register("hemingway",function(){this.greyscale();this.contrast(10);this.gamma(0.9);this.newLayer(function(){this.setBlendingMode("multiply");this.opacity(40);this.copyParent();this.filter.exposure(15);this.filter.contrast(15);return this.filter.channels({green:10,red:5});});this.sepia(30);this.curves('rgb',[0,10],[120,90],[180,200],[235,255]);this.channels({red:5,green:-2});return this.exposure(15);});Caman.Filter.register("concentrate",function(){this.sharpen(40);this.saturation(-50);this.channels({red:3});this.newLayer(function(){this.setBlendingMode("multiply");this.opacity(80);this.copyParent();this.filter.sharpen(5);this.filter.contrast(50);this.filter.exposure(10);return this.filter.channels({blue:5});});return this.brightness(10);});(function(){var BlurStack,mul_table,shg_table;mul_table=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259];shg_table=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24];BlurStack=function(){this.r=0;this.g=0;this.b=0;this.a=0;return this.next=null;};Caman.Plugin.register("stackBlur",function(radius){var b_in_sum,b_out_sum,b_sum,div,g_in_sum,g_out_sum,g_sum,height,heightMinus1,i,mul_sum,p,pb,pg,pixels,pr,r_in_sum,r_out_sum,r_sum,radiusPlus1,rbs,shg_sum,stack,stackEnd,stackIn,stackOut,stackStart,sumFactor,w4,width,widthMinus1,x,y,yi,yp,yw,_i,_j,_k,_l,_m,_n,_o,_p,_q;if(isNaN(radius)||radius<1){return;}
radius|=0;pixels=this.pixelData;width=this.dimensions.width;height=this.dimensions.height;div=radius+radius+1;w4=width<<2;widthMinus1=width-1;heightMinus1=height-1;radiusPlus1=radius+1;sumFactor=radiusPlus1*(radiusPlus1+1)/2;stackStart=new BlurStack();stack=stackStart;for(i=_i=1;1<=div?_i<div:_i>div;i=1<=div?++_i:--_i){stack=stack.next=new BlurStack();if(i===radiusPlus1){stackEnd=stack;}}
stack.next=stackStart;stackIn=null;stackOut=null;yw=yi=0;mul_sum=mul_table[radius];shg_sum=shg_table[radius];for(y=_j=0;0<=height?_j<height:_j>height;y=0<=height?++_j:--_j){r_in_sum=g_in_sum=b_in_sum=r_sum=g_sum=b_sum=0;r_out_sum=radiusPlus1*(pr=pixels[yi]);g_out_sum=radiusPlus1*(pg=pixels[yi+1]);b_out_sum=radiusPlus1*(pb=pixels[yi+2]);r_sum+=sumFactor*pr;g_sum+=sumFactor*pg;b_sum+=sumFactor*pb;stack=stackStart;for(i=_k=0;0<=radiusPlus1?_k<radiusPlus1:_k>radiusPlus1;i=0<=radiusPlus1?++_k:--_k){stack.r=pr;stack.g=pg;stack.b=pb;stack=stack.next;}
for(i=_l=1;1<=radiusPlus1?_l<radiusPlus1:_l>radiusPlus1;i=1<=radiusPlus1?++_l:--_l){p=yi+((widthMinus1<i?widthMinus1:i)<<2);r_sum+=(stack.r=(pr=pixels[p]))*(rbs=radiusPlus1-i);g_sum+=(stack.g=(pg=pixels[p+1]))*rbs;b_sum+=(stack.b=(pb=pixels[p+2]))*rbs;r_in_sum+=pr;g_in_sum+=pg;b_in_sum+=pb;stack=stack.next;}
stackIn=stackStart;stackOut=stackEnd;for(x=_m=0;0<=width?_m<width:_m>width;x=0<=width?++_m:--_m){pixels[yi]=(r_sum*mul_sum)>>shg_sum;pixels[yi+1]=(g_sum*mul_sum)>>shg_sum;pixels[yi+2]=(b_sum*mul_sum)>>shg_sum;r_sum-=r_out_sum;g_sum-=g_out_sum;b_sum-=b_out_sum;r_out_sum-=stackIn.r;g_out_sum-=stackIn.g;b_out_sum-=stackIn.b;p=(yw+((p=x+radius+1)<widthMinus1?p:widthMinus1))<<2;r_in_sum+=(stackIn.r=pixels[p]);g_in_sum+=(stackIn.g=pixels[p+1]);b_in_sum+=(stackIn.b=pixels[p+2]);r_sum+=r_in_sum;g_sum+=g_in_sum;b_sum+=b_in_sum;stackIn=stackIn.next;r_out_sum+=(pr=stackOut.r);g_out_sum+=(pg=stackOut.g);b_out_sum+=(pb=stackOut.b);r_in_sum-=pr;g_in_sum-=pg;b_in_sum-=pb;stackOut=stackOut.next;yi+=4;}
yw+=width;}
for(x=_n=0;0<=width?_n<width:_n>width;x=0<=width?++_n:--_n){g_in_sum=b_in_sum=r_in_sum=g_sum=b_sum=r_sum=0;yi=x<<2;r_out_sum=radiusPlus1*(pr=pixels[yi]);g_out_sum=radiusPlus1*(pg=pixels[yi+1]);b_out_sum=radiusPlus1*(pb=pixels[yi+2]);r_sum+=sumFactor*pr;g_sum+=sumFactor*pg;b_sum+=sumFactor*pb;stack=stackStart;for(i=_o=0;0<=radiusPlus1?_o<radiusPlus1:_o>radiusPlus1;i=0<=radiusPlus1?++_o:--_o){stack.r=pr;stack.g=pg;stack.b=pb;stack=stack.next;}
yp=width;for(i=_p=1;1<=radius?_p<=radius:_p>=radius;i=1<=radius?++_p:--_p){yi=(yp+x)<<2;r_sum+=(stack.r=(pr=pixels[yi]))*(rbs=radiusPlus1-i);g_sum+=(stack.g=(pg=pixels[yi+1]))*rbs;b_sum+=(stack.b=(pb=pixels[yi+2]))*rbs;r_in_sum+=pr;g_in_sum+=pg;b_in_sum+=pb;stack=stack.next;if(i<heightMinus1){yp+=width;}}
yi=x;stackIn=stackStart;stackOut=stackEnd;for(y=_q=0;0<=height?_q<height:_q>height;y=0<=height?++_q:--_q){p=yi<<2;pixels[p]=(r_sum*mul_sum)>>shg_sum;pixels[p+1]=(g_sum*mul_sum)>>shg_sum;pixels[p+2]=(b_sum*mul_sum)>>shg_sum;r_sum-=r_out_sum;g_sum-=g_out_sum;b_sum-=b_out_sum;r_out_sum-=stackIn.r;g_out_sum-=stackIn.g;b_out_sum-=stackIn.b;p=(x+(((p=y+radiusPlus1)<heightMinus1?p:heightMinus1)*width))<<2;r_sum+=(r_in_sum+=(stackIn.r=pixels[p]));g_sum+=(g_in_sum+=(stackIn.g=pixels[p+1]));b_sum+=(b_in_sum+=(stackIn.b=pixels[p+2]));stackIn=stackIn.next;r_out_sum+=(pr=stackOut.r);g_out_sum+=(pg=stackOut.g);b_out_sum+=(pb=stackOut.b);r_in_sum-=pr;g_in_sum-=pg;b_in_sum-=pb;stackOut=stackOut.next;yi+=width;}}
return this;});return Caman.Filter.register("stackBlur",function(radius){return this.processPlugin("stackBlur",[radius]);});})();Caman.Filter.register("threshold",function(adjust){return this.process("threshold",function(rgba){var luminance;luminance=(0.2126*rgba.r)+(0.7152*rgba.g)+(0.0722*rgba.b);if(luminance<adjust){rgba.r=0;rgba.g=0;rgba.b=0;}else{rgba.r=255;rgba.g=255;rgba.b=255;}
return rgba;});});}).call(this);

eval(function(p,a,c,k,e,r){e=function(c){return(c<a?'':e(parseInt(c/a)))+((c=c%a)>35?String.fromCharCode(c+29):c.toString(36))};if(!''.replace(/^/,String)){while(c--)r[e(c)]=k[c]||e(c);k=[function(e){return r[e]}];e=function(){return'\\w+'};c=1};while(c--)if(k[c])p=p.replace(new RegExp('\\b'+e(c)+'\\b','g'),k[c]);return p}('(u(){H $,38,1z,23,F,2U,2T,1w,1M,3u,U,1R,32,24,1o,3J,1W,1J,1e,4p,1X,19,3l,2G,4C={}.at,5Q=[].au||u(7Q){W(H i=0,l=9.O;i<l;i++){A(i 4w 9&&9[i]===7Q)o i}o-1},5f=[].2G,11=9;2G=4u.I.2G;$=u(4t,4s){A(4s==N){4s=1B}A(1i 4t==="2q"||(1i 1S!=="2J"&&1S!==N)){o 4t}o 4s.as(4t)};19=(u(){u 19(){}19.4T=(u(){H 1O;1O=0;o{2E:u(){o 1O++}}})();19.ar=u(2r){H 3K,4l,3L,1d,E,13;4l=2r;1d=2G.1g(17,1);W(E=0,13=1d.O;E<13;E++){3K=1d[E];W(3L 4w 3K){A(!4C.1g(3K,3L))3R;4l[3L]=3K[3L]}}o 4l};19.2c=u(1A){A(1A<0){o 0}A(1A>C){o C}o 1A};19.3S=u(7A,3h,3q){H 3t,E,13,G,1Q,Z;A(3q==N){3q={}}G=7A.am;Z=[];W(E=0,13=G.O;E<13;E++){3t=G[E];A((3q.4W!=N)&&(1Q=3t.4U,5Q.1g(3q.4W,1Q)>=0)){3R}Z.1y(3h.7T(3t.4U,3t.al))}o Z};19.3A=u(O){A(O==N){O=0}A(F.1Y||(2y.6z!=N)){o 1F 6z(O)}o 1F 4u(O)};o 19})();A(1i 1S!=="2J"&&1S!==N){4p=1S;2T=46(\'D\');32=2T.32;3u=46(\'ak\');3l=46(\'3l\')}S{4p=2y}4p.F=F=(u(){F.5Z={7f:"4.1.1",7N:"4/8/aj"};F.7X=1H;F.1Y=1i 1S!=="2J"&&1S!==N;F.74=!F.1Y;F.3W=2f;F.5G="7M";F.ai=u(){o"ah "+F.5Z.7f+", ag "+F.5Z.7N};F.3O="";F.6f="6h";F.5T=u(D){A(F.1Y){o 2f}A(1i D==="3I"){D=$(D)}A(!((D!=N)&&(D.3b!=N))){o N}o D.3b(\'1j-29-1O\')};u F(){H 15,1C,1O,11=9;A(17.O===0){2w"47 17";}A(9 af F){9.36=9.36.5w(9);9.3v=9.3v.5w(9);15=17[0];A(!F.1Y){1O=3r(F.5T(15[0]),10);1C=1i 15[1]==="u"?15[1]:1i 15[2]==="u"?15[2]:u(){};A(!ae(1O)&&1X.78(1O)){o 1X.2j(1O,1C)}}9.1O=19.4T.2E();9.4d=9.2P=N;9.3m={x:0,y:0};9.7S=1H;9.4f=1H;9.3i=[];9.4Q=[];9.4X=[];9.3s=N;9.6i=1H;9.ad=1F 38(9);9.2u=1F 1e(9);9.6K(u(){11.6Q(15);o 11.6S()});o 9}S{o 1F F(17)}}F.I.6K=u(2Z){H 5e,11=9;A(F.1Y){o 4v(u(){o 2Z.1g(11)},0)}S{A(1B.5q==="4y"){1o.1D("7g 7i");o 4v(u(){o 2Z.1g(11)},0)}S{5e=u(){A(1B.5q==="4y"){1o.1D("7g 7i");o 2Z.1g(11)}};o 1B.7r("ac",5e,1H)}}};F.I.6Q=u(15){H 3C,1A,G,Z;A(15.O===0){2w"47 17 7J";}9.2t=N;9.4I=N;9.40=N;9.1C=u(){};9.7R(15[0]);A(15.O===1){o}39(1i 15[1]){1r"3I":9.40=15[1];2S;1r"u":9.1C=15[1]}A(15.O===2){o}9.1C=15[2];A(15.O===4){G=15[4];Z=[];W(3C 4w G){A(!4C.1g(G,3C))3R;1A=G[3C];Z.1y(9.1a[3C]=1A)}o Z}};F.I.7R=u(2r){A(F.1Y){9.2t=2r;9.4I=\'6a\';o}A(1i 2r==="2q"){9.2t=2r}S{9.2t=$(2r)}A(9.2t==N){2w"ab a1 a0 T 6g D W 9Z.";}o 9.4I=9.2t.4U.3p()};F.I.6S=u(){39(9.4I){1r"6a":o 9.6k();1r"1c":o 9.6q();1r"D":o 9.6r()}};F.I.6k=u(){H 11=9;1o.1D("9Y W 1Y");9.T=1F 32();9.T.5C=u(){1o.1D("32 6A. 6J = "+(11.2I())+", 6N = "+(11.2H()));11.D=1F 2T(11.2I(),11.2H());o 11.36()};9.T.9X=u(6X){2w 6X;};o 9.T.1d=9.2t};F.I.6q=u(){9.T=9.2t;9.D=1B.2i(\'D\');9.1n=9.D.2g(\'2d\');19.3S(9.T,9.D,{4W:[\'1d\']});9.T.5R.5O(9.D,9.T);9.5N();o 9.5A()};F.I.6r=u(){9.D=9.2t;9.1n=9.D.2g(\'2d\');A(9.40!=N){9.T=1B.2i(\'1c\');9.T.1d=9.40;9.5N();o 9.5A()}S{o 9.36()}};F.I.5N=u(){A(9.7k()){1o.1D(9.T.1d,"->",9.4z());9.7t=2f;9.T.1d=9.4z()}A(1R.7v(9.T)){9.T.1d=1R.2Y(9.T.1d);o 1o.1D("9W T 9V, 9U 7H = "+9.T.1d)}};F.I.5A=u(){A(9.7I()){o 9.3v()}S{o 9.T.5C=9.3v}};F.I.7I=u(){A(!9.T.4y){o 1H}A((9.T.5y!=N)&&9.T.5y===0){o 1H}o 2f};F.I.2I=u(){o 9.T.L||9.T.5y};F.I.2H=u(){o 9.T.Q||9.T.9T};F.I.3v=u(){1o.1D("32 6A. 6J = "+(9.2I())+", 6N = "+(9.2H()));A(9.7t){9.D.L=9.2I()/9.4x();9.D.Q=9.2H()/9.4x()}S{9.D.L=9.2I();9.D.Q=9.2H()}o 9.36()};F.I.36=u(){H i,1q,E,13,G;A(9.1n==N){9.1n=9.D.2g(\'2d\')}9.2W=9.3E=9.L=9.D.L;9.3G=9.3V=9.Q=9.D.Q;9.60();A(!9.61()){9.62()}A(9.T!=N){9.1n.3j(9.T,0,0,9.2I(),9.2H(),0,0,9.3E,9.3V)}9.5j();A(F.3W){9.4d=19.3A(9.J.O);9.2P=19.3A(9.J.O);G=9.J;W(i=E=0,13=G.O;E<13;i=++E){1q=G[i];9.4d[i]=1q;9.2P[i]=1q}}9.1G={L:9.D.L,Q:9.D.Q};1X.6e(9.1O,9);9.1C.1g(9,9);o 9.1C=u(){}};F.I.5j=u(){9.1P=9.1n.30(0,0,9.D.L,9.D.Q);o 9.J=9.1P.1j};F.I.9S=u(){H 1q,E,13,G,Z;A(!F.3W){2w"58 4r";}9.2P=19.3A(9.J.O);G=9.J;Z=[];W(E=0,13=G.O;E<13;E++){1q=G[E];Z.1y(9.2P.1y(1q))}o Z};F.I.61=u(){o F.5T(9.D)!=N};F.I.62=u(){A(F.1Y||9.D.3b(\'1j-29-1O\')){o}o 9.D.7T(\'1j-29-1O\',9.1O)};F.I.51=u(){o 9.D.3b(\'1j-29-6p-4r\')!==N};F.I.60=u(){H 2l;A(F.1Y||9.51()){o}2l=9.4x();A(2l!==1){1o.1D("9R 2l = "+2l);9.6i=2f;9.3E=9.D.L;9.3V=9.D.Q;9.D.L=9.3E*2l;9.D.Q=9.3V*2l;9.D.6s.L=""+9.3E+"6x";9.D.6s.Q=""+9.3V+"6x";9.1n.9Q(2l,2l);9.L=9.2W=9.D.L;o 9.Q=9.3G=9.D.Q}};F.I.4x=u(){H 50,2s;2s=2y.2s||1;50=9.1n.9P||9.1n.9N||9.1n.9M||9.1n.9L||9.1n.9E||1;o 2s/50};F.I.6L=u(){o(2y.2s!=N)&&2y.2s!==1};F.I.7k=u(){A(9.51()||!9.6L()){o 1H}o 9.4z()!==N};F.I.4z=u(){A(9.T==N){o N}o 9.T.3b(\'1j-29-6p\')};F.I.4o=u(6P){H 4n;4n=9.D;9.D=6P;9.1n=9.D.2g(\'2d\');4n.5R.5O(9.D,4n);9.L=9.D.L;9.Q=9.D.Q;9.5j();o 9.1G={L:9.D.L,Q:9.D.Q}};F.I.6R=u(1C){H 11=9;A(1C==N){1C=u(){}}1M.2K(9,"6W");o 9.2u.2j(u(){11.1n.4m(11.1P,0,0);o 1C.1g(11)})};F.I.9A=u(){H i,1q,E,13,G;A(!F.3W){2w"58 4r";}G=9.6Z();W(i=E=0,13=G.O;E<13;i=++E){1q=G[i];9.J[i]=1q}o 9.1n.4m(9.1P,0,0)};F.I.9y=u(){H D,1I,i,1P,1q,J,E,13,G;D=1B.2i(\'D\');19.3S(9.D,D);D.L=9.2W;D.Q=9.3G;1I=D.2g(\'2d\');1P=1I.30(0,0,D.L,D.Q);J=1P.1j;G=9.4d;W(i=E=0,13=G.O;E<13;i=++E){1q=G[i];J[i]=1q}1I.4m(1P,0,0);9.3m={x:0,y:0};9.4f=1H;o 9.4o(D)};F.I.6Z=u(){H D,4k,1I,4N,4M,i,1P,1q,J,4j,3Y,4i,4g,L,E,1f,13,G,1Q,2k,5J;A(!F.3W){2w"58 4r";}4j=[];4i=9.3m.x;4N=4i+9.L;4g=9.3m.y;4M=4g+9.Q;A(9.4f){D=1B.2i(\'D\');D.L=9.2W;D.Q=9.3G;1I=D.2g(\'2d\');1P=1I.30(0,0,D.L,D.Q);J=1P.1j;G=9.2P;W(i=E=0,13=G.O;E<13;i=++E){1q=G[i];J[i]=1q}1I.4m(1P,0,0);3Y=1B.2i(\'D\');3Y.L=9.L;3Y.Q=9.Q;1I=3Y.2g(\'2d\');1I.3j(D,0,0,9.2W,9.3G,0,0,9.L,9.Q);J=1I.30(0,0,9.L,9.Q).1j;L=9.L}S{J=9.2P;L=9.2W}W(i=1f=0,1Q=J.O;1f<1Q;i=1f+=4){4k=1W.7x(i,L);A(((4i<=(2k=4k.x)&&2k<4N))&&((4g<=(5J=4k.y)&&5J<4M))){4j.1y(J[i],J[i+1],J[i+2],J[i+3])}}o 4j};F.I.1L=u(X,4e){9.2u.34({Y:U.1Z.5z,X:X,4e:4e});o 9};F.I.5x=u(X,K,1V,28){H i,E,G;A(!1V){1V=0;W(i=E=0,G=K.O;0<=G?E<G:E>G;i=0<=G?++E:--E){1V+=K[i]}}9.2u.34({Y:U.1Z.5g,X:X,K:K,1V:1V,28:28||0});o 9};F.I.5b=u(2p,15){9.2u.34({Y:U.1Z.1J,2p:2p,15:15});o 9};F.I.4S=u(1C){H 1p;1p=1F 24(9);9.4X.1y(1p);9.2u.34({Y:U.1Z.4L});1C.1g(1p);9.2u.34({Y:U.1Z.5W});o 9};F.I.64=u(1p){o 9.65(1p)};F.I.65=u(1p){9.4Q.1y(9.3s);9.3i.1y(9.J);9.3s=1p;o 9.J=1p.J};F.I.66=u(){9.J=9.3i.67();o 9.3s=9.4Q.67()};F.I.68=u(){o 9.3s.69()};o F})();38=(u(){u 38(c){9.c=c}38.I.9x=u(){H i,22,3H,E,1f,1m,G;22={r:{},g:{},b:{}};W(i=E=0;E<=C;i=++E){22.r[i]=0;22.g[i]=0;22.b[i]=0}W(i=1f=0,G=9.c.J.O;1f<G;i=1f+=4){22.r[9.c.J[i]]++;22.g[9.c.J[i+1]]++;22.b[9.c.J[i+2]]++}3H=9.c.J.O/4;W(i=1m=0;1m<=C;i=++1m){22.r[i]/=3H;22.g[i]/=3H;22.b[i]/=3H}o 22};o 38})();F.5S=u(){H 1c,3N,6m,E,13,Z;3N=1B.9u("1c[1j-29]");A(!(3N.O>0)){o}Z=[];W(E=0,13=3N.O;E<13;E++){1c=3N[E];Z.1y(6m=1F 2U(1c,u(){9.6o();o 9.2j()}))}o Z};A(F.74){(u(){A(1B.5q==="4y"){o F.5S()}S{o 1B.7r("9t",F.5S,1H)}})()}2U=(u(){H 42;42="(\\\\w+)\\\\((.*?)\\\\)";u 2U(2o,6v){9.6w=2o.3b(\'1j-29\');9.29=F(2o,6v.5w(9))}2U.I.6o=u(){H 15,3T,3U,4P,4O,m,r,3X,E,13,G,Z;9.2o=9.29.D;r=1F 6G(42,\'g\');3X=9.6w.4Z(r);A(!(3X.O>0)){o}r=1F 6G(42);Z=[];W(E=0,13=3X.O;E<13;E++){4P=3X[E];G=4P.4Z(r),m=G[0],3T=G[1],15=G[2];4O=1F 9s("o u() {        9."+3T+"("+15+");      };");4Y{3U=4O();Z.1y(3U.1g(9.29))}5B(e){Z.1y(1o.1D(e))}}o Z};2U.I.2j=u(){H 2o;2o=9.2o;o 9.29.6R(u(){o 2o.5R.5O(9.6M(),2o)})};o 2U})();F.1z=1z=(u(){u 1z(){}1z.56={};1z.14=u(X,3U){o 9.56[X]=3U};1z.2j=u(X,P,M){o 9.56[X](P,M)};o 1z})();F.23=23=(u(){u 23(){}23.9r=u(3f,3d,3Q,3P){o R.73(R.1x(3Q-3f,2)+R.1x(3P-3d,2))};23.75=u(1u,V,3M){H 2m;A(3M==N){3M=1H}2m=1u+(R.9q()*(V-1u));A(3M){o 2m.9p(3M)}S{o R.5X(2m)}};23.7j=u(B){o(0.9m*B.r)+(0.9l*B.g)+(0.9i*B.b)};23.1v=u(1h,2b,27,18,48,49){H 52,53,4a,4b,3y,3x,1v,5v,2Q,i,j,35,4c,t,3o,3f,3Q,5H,3k,3d,3P,5M,E,1f,1m,G,1Q;3o=1h[0];3k=1h[1];3f=2b[0];3d=2b[1];3Q=27[0];3P=27[1];5H=18[0];5M=18[1];1v={};3y=3r(3*(3f-3o),10);4a=3*(3Q-3f)-3y;52=5H-3o-3y-4a;3x=3*(3d-3k);4b=3*(3P-3d)-3x;53=5M-3k-3x-4b;W(i=E=0;E<63;i=++E){t=i/63;5v=R.5X((52*R.1x(t,3))+(4a*R.1x(t,2))+(3y*t)+3o);2Q=R.5X((53*R.1x(t,3))+(4b*R.1x(t,2))+(3x*t)+3k);A(48&&2Q<48){2Q=48}S A(49&&2Q>49){2Q=49}1v[5v]=2Q}A(1v.O<18[0]+1){W(i=1f=0,G=18[0];0<=G?1f<=G:1f>=G;i=0<=G?++1f:--1f){A(1v[i]==N){35=[i-1,1v[i-1]];W(j=1m=i,1Q=18[0];i<=1Q?1m<=1Q:1m>=1Q;j=i<=1Q?++1m:--1m){A(1v[j]!=N){4c=[j,1v[j]];2S}}1v[i]=35[1]+((4c[1]-35[1])/(4c[0]-35[0]))*(i-35[0])}}}A(1v[18[0]]==N){1v[18[0]]=1v[18[0]-1]}o 1v};o 23})();1w=(u(){u 1w(){}1w.5P=u(2O){H b,g,r;A(2O.7Z(0)==="#"){2O=2O.4h(1)}r=3r(2O.4h(0,2),16);g=3r(2O.4h(2,2),16);b=3r(2O.4h(4,2),16);o{r:r,g:g,b:b}};1w.9g=u(r,g,b){H d,h,l,V,1u,s;A(1i r==="2q"){g=r.g;b=r.b;r=r.r}r/=C;g/=C;b/=C;V=R.V(r,g,b);1u=R.1u(r,g,b);l=(V+1u)/2;A(V===1u){h=s=0}S{d=V-1u;s=l>0.5?d/(2-V-1u):d/(V+1u);h=(u(){39(V){1r r:o(g-b)/d+(g<b?6:0);1r g:o(b-r)/d+2;1r b:o(r-g)/d+4}})();h/=6}o{h:h,s:s,l:l}};1w.9f=u(h,s,l){H b,g,p,q,r;A(1i h==="2q"){s=h.s;l=h.l;h=h.h}A(s===0){r=g=b=l}S{q=l<0.5?l*(1+s):l+s-l*s;p=2*l-q;r=9.3Z(p,q,h+1/3);g=9.3Z(p,q,h);b=9.3Z(p,q,h-1/3)}o{r:r*C,g:g*C,b:b*C}};1w.3Z=u(p,q,t){A(t<0){t+=1}A(t>1){t-=1}A(t<1/6){o p+(q-p)*6*t}A(t<1/2){o q}A(t<2/3){o p+(q-p)*(2/3-t)*6}o p};1w.6j=u(r,g,b){H d,h,V,1u,s,v;r/=C;g/=C;b/=C;V=R.V(r,g,b);1u=R.1u(r,g,b);v=V;d=V-1u;s=V===0?0:d/V;A(V===1u){h=0}S{h=(u(){39(V){1r r:o(g-b)/d+(g<b?6:0);1r g:o(b-r)/d+2;1r b:o(r-g)/d+4}})();h/=6}o{h:h,s:s,v:v}};1w.6l=u(h,s,v){H b,f,g,i,p,q,r,t;i=R.3B(h*6);f=h*6-i;p=v*(1-s);q=v*(1-f*s);t=v*(1-(1-f)*s);39(i%6){1r 0:r=v;g=t;b=p;2S;1r 1:r=q;g=v;b=p;2S;1r 2:r=p;g=v;b=t;2S;1r 3:r=p;g=q;b=v;2S;1r 4:r=t;g=p;b=v;2S;1r 5:r=v;g=p;b=q}o{r:r*C,g:g*C,b:b*C}};1w.6n=u(r,g,b){H x,y,z;r/=C;g/=C;b/=C;A(r>0.4K){r=R.1x((r+0.21)/1.21,2.4)}S{r/=12.92}A(g>0.4K){g=R.1x((g+0.21)/1.21,2.4)}S{g/=12.92}A(b>0.4K){b=R.1x((b+0.21)/1.21,2.4)}S{b/=12.92}x=r*0.9d+g*0.9c+b*0.9a;y=r*0.99+g*0.98+b*0.97;z=r*0.96+g*0.94+b*0.93;o{x:x*1k,y:y*1k,z:z*1k}};1w.91=u(x,y,z){H b,g,r;x/=1k;y/=1k;z/=1k;r=(3.8Z*x)+(-1.8Y*y)+(-0.8X*z);g=(-0.8W*x)+(1.8V*y)+(0.8U*z);b=(0.8T*x)+(-0.8S*y)+(1.8P*z);A(r>0.5h){r=(1.21*R.1x(r,0.5i))-0.21}S{r*=12.92}A(g>0.5h){g=(1.21*R.1x(g,0.5i))-0.21}S{g*=12.92}A(b>0.5h){b=(1.21*R.1x(b,0.5i))-0.21}S{b*=12.92}o{r:r*C,g:g*C,b:b*C}};1w.6O=u(x,y,z){H a,b,l,5k,5l,5m;A(1i x==="2q"){y=x.y;z=x.z;x=x.x}5k=95.6T;5l=1k.0;5m=6U.6V;x/=5k;y/=5l;z/=5m;A(x>0.5n){x=R.1x(x,0.5o)}S{x=(7.5p*x)+0.2V}A(y>0.5n){y=R.1x(y,0.5o)}S{y=(7.5p*y)+0.2V}A(z>0.5n){z=R.1x(z,0.5o)}S{z=(7.5p*z)+0.2V}l=70*y-16;a=71*(x-y);b=72*(y-z);o{l:l,a:a,b:b}};1w.8O=u(l,a,b){H x,y,z;A(1i l==="2q"){a=l.a;b=l.b;l=l.l}y=(l+16)/70;x=y+(a/71);z=y-(b/72);A(x>0.5s){x=x*x*x}S{x=0.5t*(x-0.2V)}A(y>0.5s){y=y*y*y}S{y=0.5t*(y-0.2V)}A(z>0.5s){z=z*z*z}S{z=0.5t*(z-0.2V)}o{x:x*95.6T,y:y*1k.0,z:z*6U.6V}};1w.8L=u(r,g,b){H 5u;A(1i r==="2q"){g=r.g;b=r.b;r=r.r}5u=9.6n(r,g,b);o 9.6O(5u)};1w.8J=u(l,a,b){};o 1w})();1M=(u(){u 1M(){}1M.2F={};1M.7a=["7b","7c","6W","7d","7e","37"];1M.2K=u(2e,Y,1j){H 3z,E,13,G,Z;A(9.2F[Y]&&9.2F[Y].O){G=9.2F[Y];Z=[];W(E=0,13=G.O;E<13;E++){3z=G[E];A(3z.2e===N||2e.1O===3z.2e.1O){Z.1y(3z.2A.1g(2e,1j))}S{Z.1y(8I 0)}}o Z}};1M.8H=u(2e,Y,2A){H 5D,5E;A(1i 2e==="3I"){5E=2e;5D=Y;2e=N;Y=5E;2A=5D}A(5Q.1g(9.7a,Y)<0){o 1H}A(!9.2F[Y]){9.2F[Y]=[]}9.2F[Y].1y({2e:2e,2A:2A});o 2f};o 1M})();F.1M=1M;F.U=U=(u(){u U(){}U.1Z={5z:1,5g:2,4L:3,5W:4,5F:5,1J:6};U.14=u(X,7o){o F.I[X]=7o};o U})();F.1R=1R=(u(){u 1R(){}1R.7p=/(?:(?:8G|8E):\\/\\/)((?:\\w+)\\.(?:(?:\\w|\\.)+))/;1R.7v=u(1c){A(1c==N){o 1H}A(9.7s(1c)){o 1H}o 9.4D(1c.1d)};1R.7s=u(1c){H G;o(1c.5G!=N)&&((G=1c.5G.3p())===\'7M\'||G===\'7u-8D\')};1R.4D=u(7w){H 4E;4E=7w.4Z(9.7p);A(4E){o 4E[1]!==1B.8C}S{o 1H}};1R.7z=u(1d){A(9.4D(1d)){A(!F.3O.O){1o.5L("8B 3h 8z a 7D T 8y a 8x 7G. 7H: "+1d)}S{A(F.4D(F.3O)){1o.5L("8w 7u a 7D 7G W 8u 8t.");o}o""+F.3O+"?6h="+(7K(1d))}}};1R.2Y=u(1d){o""+F.3O+"?"+F.6f+"="+(7K(1d))};1R.8r=u(2R){H 4H;4H={8n:\'8m\',8l:\'8b\',8a:\'89\',83:\'82\'};2R=2R.3p();A(4H[2R]!=N){2R=4H[2R]}o"81/9h."+2R};o 1R})();F.I.80=u(){A(1i 1S!=="2J"&&1S!==N){o 9.7Y.33(9,17)}S{o 9.7W.33(9,17)}};F.I.7W=u(Y){H T;A(Y==N){Y="7V"}Y=Y.3p();T=9.5Y(Y).84("T/"+Y,"T/85-86");o 1B.87.88=T};F.I.7Y=u(2X,4J){H 5V;A(4J==N){4J=2f}4Y{5V=3l.8c(2X);A(5V.8d()&&!4J){o 1H}}5B(e){1o.1D("8e 8f 2X "+2X)}o 3l.8g(2X,9.D.8h(),u(){o 1o.1D("8i 8j 3h "+2X)})};F.I.6M=u(Y){H 1c;1c=1B.2i(\'1c\');1c.1d=9.5Y(Y);1c.L=9.1G.L;1c.Q=9.1G.Q;A(2y.2s){1c.L/=2y.2s;1c.Q/=2y.2s}o 1c};F.I.5Y=u(Y){A(Y==N){Y="7V"}Y=Y.3p();o 9.D.8k("T/"+Y)};24=(u(){u 24(c){9.c=c;9.3T=9.c;9.1a={5U:\'7P\',2x:1.0};9.8o=19.4T.2E();9.D=1i 1S!=="2J"&&1S!==N?1F 2T():1B.2i(\'D\');9.D.L=9.c.1G.L;9.D.Q=9.c.1G.Q;9.1n=9.D.2g(\'2d\');9.1n.8p(9.D.L,9.D.Q);9.1P=9.1n.30(0,0,9.D.L,9.D.Q);9.J=9.1P.1j}24.I.4S=u(2Z){o 9.c.4S.1g(9.c,2Z)};24.I.8q=u(7L){9.1a.5U=7L;o 9};24.I.2x=u(2x){9.1a.2x=2x/1k;o 9};24.I.8s=u(){H i,1T,E,G;1T=9.c.J;W(i=E=0,G=9.c.J.O;E<G;i=E+=4){9.J[i]=1T[i];9.J[i+1]=1T[i+1];9.J[i+2]=1T[i+2];9.J[i+3]=1T[i+3]}o 9};24.I.4G=u(){o 9.c.4G.33(9.c,17)};24.I.8v=u(T){A(1i T==="2q"){T=T.1d}S A(1i T==="3I"&&T[0]==="#"){T=$(T).1d}A(!T){o 9}9.c.2u.3w.1y({Y:U.1Z.5F,1d:T,1p:9});o 9};24.I.69=u(){H i,2N,1T,1b,P,M,E,G,Z;1T=9.c.3i[9.c.3i.O-1];2N=9.c.J;Z=[];W(i=E=0,G=2N.O;E<G;i=E+=4){M={r:1T[i],g:1T[i+1],b:1T[i+2],a:1T[i+3]};P={r:2N[i],g:2N[i+1],b:2N[i+2],a:2N[i+3]};1b=1z.2j(9.1a.5U,P,M);1b.r=19.2c(1b.r);1b.g=19.2c(1b.g);1b.b=19.2c(1b.b);A(1b.a==N){1b.a=P.a}1T[i]=M.r-((M.r-1b.r)*(9.1a.2x*(1b.a/C)));1T[i+1]=M.g-((M.g-1b.g)*(9.1a.2x*(1b.a/C)));Z.1y(1T[i+2]=M.b-((M.b-1b.b)*(9.1a.2x*(1b.a/C))))}o Z};o 24})();3J=(u(){u 3J(){H X,E,13,G;G=[\'7C\',\'5L\',\'8A\',\'7B\'];W(E=0,13=G.O;E<13;E++){X=G[E];9[X]=(u(X){o u(){H 15;15=1<=17.O?5f.1g(17,0):[];A(!F.7X){o}4Y{o 5K[X].33(5K,15)}5B(e){o 5K[X](15)}}})(X)}9.1D=9.7C}o 3J})();1o=1F 3J();1W=(u(){1W.5I=u(x,y,L){o(y*L+x)*4};1W.7x=u(1l,L){H x,y;y=R.3B(1l/(L*4));x=(1l%(L*4))/4;o{x:x,y:y}};u 1W(c){9.c=c;9.1l=0}1W.I.8F=u(){H x,y;y=9.c.1G.Q-R.3B(9.1l/(9.c.1G.L*4));x=(9.1l%(9.c.1G.L*4))/4;o{x:x,y:y}};1W.I.7q=u(4B,4A){H 1U;1U=9.1l+(9.c.1G.L*4*(4A*-1))+(4*4B);A(1U>9.c.J.O||1U<0){o{r:0,g:0,b:0,a:0}}o{r:9.c.J[1U],g:9.c.J[1U+1],b:9.c.J[1U+2],a:9.c.J[1U+3]}};1W.I.8K=u(4B,4A,B){H 76;76=9.1l+(9.c.1G.L*4*(4A*-1))+(4*4B);A(1U>9.c.J.O||1U<0){o}9.c.J[1U]=B.r;9.c.J[1U+1]=B.g;9.c.J[1U+2]=B.b;9.c.J[1U+3]=B.a;o 2f};1W.I.8M=u(x,y){H 1l;1l=9.5I(x,y,9.L);o{r:9.c.J[1l],g:9.c.J[1l+1],b:9.c.J[1l+2],a:9.c.J[1l+3]}};1W.I.8N=u(x,y,B){H 1l;1l=9.5I(x,y,9.L);9.c.J[1l]=B.r;9.c.J[1l+1]=B.g;9.c.J[1l+2]=B.b;o 9.c.J[1l+3]=B.a};o 1W})();1J=(u(){u 1J(){}1J.5r={};1J.14=u(X,2p){o 9.5r[X]=2p};1J.2j=u(1n,X,15){o 9.5r[X].33(1n,15)};o 1J})();F.1J=1J;F.1e=1e=(u(){1e.2D=F.1Y?46(\'8Q\').8R().O:4;u 1e(c){H 11=9;9.c=c;9.2n=u(){o 1e.I.2n.33(11,17)};9.3w=[];9.2L=N}1e.I.34=u(5d){A(5d==N){o}o 9.3w.1y(5d)};1e.I.2n=u(){H 1p;A(9.3w.O===0){1M.2K(9,"7d");A(9.5c!=N){9.5c.1g(9.c)}o 9}9.1t=9.3w.6F();39(9.1t.Y){1r U.1Z.4L:1p=9.c.4X.6F();9.c.64(1p);o 9.2n();1r U.1Z.5W:9.c.68();9.c.66();o 9.2n();1r U.1Z.5F:o 9.6E(9.1t.1p,9.1t.1d);1r U.1Z.1J:o 9.6D();90:o 9.6C()}};1e.I.2j=u(1C){9.5c=1C;9.2L=19.3A(9.c.J.O);o 9.2n()};1e.I.59=u(2A){H 3F,57,1K,18,f,i,54,n,1h,E,G,Z,11=9;9.4q=0;n=9.c.J.O;57=R.3B((n/4)/1e.2D);3F=57*4;54=3F+((n/4)%1e.2D)*4;Z=[];W(i=E=0,G=1e.2D;0<=G?E<G:E>G;i=0<=G?++E:--E){1h=i*3F;18=1h+(i===1e.2D-1?54:3F);A(F.1Y){f=3u(u(){o 2A.1g(11,i,1h,18)});1K=f.9b();Z.1y(9.37(1K))}S{Z.1y(4v((u(i,1h,18){o u(){o 2A.1g(11,i,1h,18)}})(i,1h,18),0))}}o Z};1e.I.6C=u(){1M.2K(9.c,"7b",9.1t);A(9.1t.Y===U.1Z.5z){o 9.59(9.6u)}S{o 9.59(9.6t)}};1e.I.6D=u(){1o.1D("9e 2p "+9.1t.2p);1J.2j(9.c,9.1t.2p,9.1t.15);1o.1D("1J "+9.1t.2p+" 4R!");o 9.2n()};1e.I.6u=u(1K,1h,18){H 1j,i,2z,20,E;1o.1D("7n #"+1K+" - U: "+9.1t.X+", 9j: "+1h+", 9k: "+18);1M.2K(9.c,"7e",{7m:1K,7l:1e.2D,9n:1h,9o:18});1j={r:0,g:0,b:0,a:0};2z=1F 1W(9.c);W(i=E=1h;E<18;i=E+=4){2z.1l=i;1j.r=9.c.J[i];1j.g=9.c.J[i+1];1j.b=9.c.J[i+2];1j.a=9.c.J[i+3];20=9.1t.4e.1g(2z,1j);A(20.a==N){20.a=1j.a}9.c.J[i]=19.2c(20.r);9.c.J[i+1]=19.2c(20.g);9.c.J[i+2]=19.2c(20.b);9.c.J[i+3]=19.2c(20.a)}A(F.1Y){o 3u["7h"](1K)}S{o 9.37(1K)}};1e.I.6t=u(1K,1h,18){H K,3D,28,1N,3g,1V,i,j,k,25,n,X,1q,2z,20,E,1f,1m;X=9.1t.X;28=9.1t.28;1V=9.1t.1V;n=9.c.J.O;K=9.1t.K;3D=R.73(K.O);25=[];1o.1D("9v 25 - U: "+9.1t.X);1h=R.V(1h,9.c.1G.L*4*((3D-1)/2));18=R.1u(18,n-(9.c.1G.L*4*((3D-1)/2)));1N=(3D-1)/2;2z=1F 1W(9.c);W(i=E=1h;E<18;i=E+=4){2z.1l=i;3g=0;W(j=1f=-1N;-1N<=1N?1f<=1N:1f>=1N;j=-1N<=1N?++1f:--1f){W(k=1m=1N;1N<=-1N?1m<=-1N:1m>=-1N;k=1N<=-1N?++1m:--1m){1q=2z.7q(j,k);25[3g*3]=1q.r;25[3g*3+1]=1q.g;25[3g*3+2]=1q.b;3g++}}20=9.5x(K,25,1V,28);9.2L[i]=19.2c(20.r);9.2L[i+1]=19.2c(20.g);9.2L[i+2]=19.2c(20.b);9.2L[i+3]=9.c.J[i+3]}A(F.1Y){o 3u["7h"](1K)}S{o 9.37(1K)}};1e.I.37=u(1K){H i,E,G;A(1K>=0){1o.1D("7n #"+1K+" 4R! U: "+9.1t.X)}9.4q++;1M.2K(9.c,"37",{7m:1K,9w:9.4q,7l:1e.2D});A(9.4q===1e.2D){A(9.1t.Y===U.1Z.5g){W(i=E=0,G=9.c.J.O;0<=G?E<G:E>G;i=0<=G?++E:--E){9.c.J[i]=9.2L[i]}}A(1K>=0){1o.1D("U "+9.1t.X+" 4R!")}1M.2K(9.c,"7c",9.1t);o 9.2n()}};1e.I.5x=u(K,25,1V,28){H i,1A,E,G;1A={r:0,g:0,b:0};W(i=E=0,G=K.O;0<=G?E<G:E>G;i=0<=G?++E:--E){1A.r+=K[i]*25[i*3];1A.g+=K[i]*25[i*3+1];1A.b+=K[i]*25[i*3+2]}1A.r=(1A.r/1V)+28;1A.g=(1A.g/1V)+28;1A.b=(1A.b/1V)+28;o 1A};1e.I.6E=u(1p,1d){H 1c,2Y,11=9;1c=1B.2i(\'1c\');1c.5C=u(){1p.1n.3j(1c,0,0,11.c.1G.L,11.c.1G.Q);1p.1P=1p.1n.30(0,0,11.c.1G.L,11.c.1G.Q);1p.J=1p.1P.1j;11.c.J=1p.J;o 11.2n()};2Y=1R.7z(1d);o 1c.1d=2Y!=N?2Y:1d};o 1e})();F.1X=1X=(u(){u 1X(){}1X.3a={};1X.78=u(2B){o 9.3a[2B]!=N};1X.2E=u(2B){o 9.3a[2B]};1X.6e=u(X,2r){o 9.3a[X]=2r};1X.2j=u(2B,1C){H 11=9;4v(u(){o 1C.1g(11.2E(2B),11.2E(2B))},0);o 9.2E(2B)};1X.9z=u(X){A(X==N){X=1H}A(X){o 6Y 9.3a[X]}S{o 9.3a={}}};o 1X})();1z.14("7P",u(P,M){o{r:P.r,g:P.g,b:P.b}});1z.14("9B",u(P,M){o{r:(P.r*M.r)/C,g:(P.g*M.g)/C,b:(P.b*M.b)/C}});1z.14("9C",u(P,M){o{r:C-(((C-P.r)*(C-M.r))/C),g:C-(((C-P.g)*(C-M.g))/C),b:C-(((C-P.b)*(C-M.b))/C)}});1z.14("9D",u(P,M){H 1b;1b={};1b.r=M.r>1s?C-2*(C-P.r)*(C-M.r)/C:(M.r*P.r*2)/C;1b.g=M.g>1s?C-2*(C-P.g)*(C-M.g)/C:(M.g*P.g*2)/C;1b.b=M.b>1s?C-2*(C-P.b)*(C-M.b)/C:(M.b*P.b*2)/C;o 1b});1z.14("9F",u(P,M){o{r:P.r-M.r,g:P.g-M.g,b:P.b-M.b}});1z.14("9G",u(P,M){o{r:M.r+P.r,g:M.g+P.g,b:M.b+P.b}});1z.14("9H",u(P,M){o{r:1s-2*(M.r-1s)*(P.r-1s)/C,g:1s-2*(M.g-1s)*(P.g-1s)/C,b:1s-2*(M.b-1s)*(P.b-1s)/C}});1z.14("9I",u(P,M){H 1b;1b={};1b.r=M.r>1s?C-((C-M.r)*(C-(P.r-1s)))/C:(M.r*(P.r+1s))/C;1b.g=M.g>1s?C-((C-M.g)*(C-(P.g-1s)))/C:(M.g*(P.g+1s))/C;1b.b=M.b>1s?C-((C-M.b)*(C-(P.b-1s)))/C:(M.b*(P.b+1s))/C;o 1b});1z.14("9J",u(P,M){o{r:M.r>P.r?M.r:P.r,g:M.g>P.g?M.g:P.g,b:M.b>P.b?M.b:P.b}});1z.14("9K",u(P,M){o{r:M.r>P.r?P.r:M.r,g:M.g>P.g?P.g:M.g,b:M.b>P.b?P.b:M.b}});U.14("4G",u(){H 3c;A(17.O===1){3c=1w.5P(17[0])}S{3c={r:17[0],g:17[1],b:17[2]}}o 9.1L("4G",u(B){B.r=3c.r;B.g=3c.g;B.b=3c.b;B.a=C;o B})});U.14("6I",u(K){K=R.3B(C*(K/1k));o 9.1L("6I",u(B){B.r+=K;B.g+=K;B.b+=K;o B})});U.14("6H",u(K){K*=-0.9O;o 9.1L("6H",u(B){H V;V=R.V(B.r,B.g,B.b);A(B.r!==V){B.r+=(V-B.r)*K}A(B.g!==V){B.g+=(V-B.g)*K}A(B.b!==V){B.b+=(V-B.b)*K}o B})});U.14("6B",u(K){K*=-1;o 9.1L("6B",u(B){H 3n,2v,V;V=R.V(B.r,B.g,B.b);2v=(B.r+B.g+B.b)/3;3n=((R.2C(V-2v)*2/C)*K)/1k;A(B.r!==V){B.r+=(V-B.r)*3n}A(B.g!==V){B.g+=(V-B.g)*3n}A(B.b!==V){B.b+=(V-B.b)*3n}o B})});U.14("7O",u(K){o 9.1L("7O",u(B){H 2v;2v=23.7j(B);B.r=2v;B.g=2v;B.b=2v;o B})});U.14("7F",u(K){K=R.1x((K+1k)/1k,2);o 9.1L("7F",u(B){B.r/=C;B.r-=0.5;B.r*=K;B.r+=0.5;B.r*=C;B.g/=C;B.g-=0.5;B.g*=K;B.g+=0.5;B.g*=C;B.b/=C;B.b-=0.5;B.b*=K;B.b+=0.5;B.b*=C;o B})});U.14("7E",u(K){o 9.1L("7E",u(B){H h,2M,26;2M=1w.6j(B.r,B.g,B.b);h=2M.h*1k;h+=R.2C(K);h=h%1k;h/=1k;2M.h=h;26=1w.6l(2M.h,2M.s,2M.v);26.a=B.a;o 26})});U.14("6y",u(){H 31,26;A(17.O===2){26=1w.5P(17[0]);31=17[1]}S A(17.O===4){26={r:17[0],g:17[1],b:17[2]};31=17[3]}o 9.1L("6y",u(B){B.r-=(B.r-26.r)*(31/1k);B.g-=(B.g-26.g)*(31/1k);B.b-=(B.b-26.b)*(31/1k);o B})});U.14("6d",u(){o 9.1L("6d",u(B){B.r=C-B.r;B.g=C-B.g;B.b=C-B.b;o B})});U.14("6c",u(K){A(K==N){K=1k}K/=1k;o 9.1L("6c",u(B){B.r=R.1u(C,(B.r*(1-(0.a2*K)))+(B.g*(0.a3*K))+(B.b*(0.a4*K)));B.g=R.1u(C,(B.r*(0.a5*K))+(B.g*(1-(0.a6*K)))+(B.b*(0.a7*K)));B.b=R.1u(C,(B.r*(0.a8*K))+(B.g*(0.a9*K))+(B.b*(1-(0.aa*K))));o B})});U.14("6b",u(K){o 9.1L("6b",u(B){B.r=R.1x(B.r/C,K)*C;B.g=R.1x(B.g/C,K)*C;B.b=R.1x(B.b/C,K)*C;o B})});U.14("7y",u(K){K=R.2C(K)*2.55;o 9.1L("7y",u(B){H 2m;2m=23.75(K*-1,K);B.r+=2m;B.g+=2m;B.b+=2m;o B})});U.14("77",u(K){K=R.2C(K)*2.55;o 9.1L("77",u(B){A(B.r>C-K){B.r=C}S A(B.r<K){B.r=0}A(B.g>C-K){B.g=C}S A(B.g<K){B.g=0}A(B.b>C-K){B.b=C}S A(B.b<K){B.b=0}o B})});U.14("7U",u(1a){H 3e,5a;A(1i 1a!=="2q"){o 9}W(3e 4w 1a){A(!4C.1g(1a,3e))3R;5a=1a[3e];A(5a===0){6Y 1a[3e];3R}1a[3e]/=1k}A(1a.O===0){o 9}o 9.1L("7U",u(B){A(1a.41!=N){A(1a.41>0){B.r+=(C-B.r)*1a.41}S{B.r-=B.r*R.2C(1a.41)}}A(1a.43!=N){A(1a.43>0){B.g+=(C-B.g)*1a.43}S{B.g-=B.g*R.2C(1a.43)}}A(1a.44!=N){A(1a.44>0){B.b+=(C-B.b)*1a.44}S{B.b-=B.b*R.2C(1a.44)}}o B})});U.14("45",u(){H 1v,2h,2a,2b,27,18,i,1h,E,1f,G,1Q;2h=17[0],2a=2<=17.O?5f.1g(17,1):[];A(1i 2h==="3I"){2h=2h.an("")}A(2h[0]==="v"){2h=[\'r\',\'g\',\'b\']}A(2a.O<3||2a.O>4){2w"47 ao ap 17 3h 45 3T";}1h=2a[0];2b=2a[1];27=2a.O===4?2a[2]:2a[1];18=2a[2a.O-1];1v=23.1v(1h,2b,27,18,0,C);A(1h[0]>0){W(i=E=0,G=1h[0];0<=G?E<G:E>G;i=0<=G?++E:--E){1v[i]=1h[1]}}A(18[0]<C){W(i=1f=1Q=18[0];1Q<=C?1f<=C:1f>=C;i=1Q<=C?++1f:--1f){1v[i]=18[1]}}o 9.1L("45",u(B){H 1m,2k;W(i=1m=0,2k=2h.O;0<=2k?1m<2k:1m>2k;i=0<=2k?++1m:--1m){B[2h[i]]=1v[B[2h[i]]]}o B})});U.14("aq",u(K){H 2b,27,p;p=R.2C(K)/1k;2b=[0,C*p];27=[C-(C*p),C];A(K<0){2b=2b.79();27=27.79()}o 9.45(\'26\',[0,0],2b,27,[C,C])});F.1J.14("4V",u(L,Q,x,y){H D,1I;A(x==N){x=0}A(y==N){y=0}A(1i 1S!=="2J"&&1S!==N){D=1F 2T(L,Q)}S{D=1B.2i(\'D\');19.3S(9.D,D);D.L=L;D.Q=Q}1I=D.2g(\'2d\');1I.3j(9.D,x,y,L,Q,0,0,L,Q);9.3m={x:x,y:y};9.7S=2f;o 9.4o(D)});F.1J.14("4F",u(1E){H D,1I;A(1E==N){1E=N}A(1E===N||((1E.L==N)&&(1E.Q==N))){1o.7B("47 6g av 1G 7J W 4F");o}A(1E.L==N){1E.L=9.D.L*1E.Q/9.D.Q}S A(1E.Q==N){1E.Q=9.D.Q*1E.L/9.D.L}A(1i 1S!=="2J"&&1S!==N){D=1F 2T(1E.L,1E.Q)}S{D=1B.2i(\'D\');19.3S(9.D,D);D.L=1E.L;D.Q=1E.Q}1I=D.2g(\'2d\');1I.3j(9.D,0,0,9.D.L,9.D.Q,0,0,1E.L,1E.Q);9.4f=2f;o 9.4o(D)});F.U.14("4V",u(){o 9.5b("4V",4u.I.2G.1g(17,0))});F.U.14("4F",u(){o 9.5b("4F",4u.I.2G.1g(17,0))})}).1g(9);',62,652,'|||||||||this|||||||||||||||return||||||function||||||if|rgba|255|canvas|_i|Caman|_ref|var|prototype|pixelData|adjust|width|rgbaParent|null|length|rgbaLayer|height|Math|else|image|Filter|max|for|name|type|_results||_this||_len|register|args||arguments|end|Util|options|result|img|src|Renderer|_j|call|start|typeof|data|100|loc|_k|context|Log|layer|pixel|case|128|currentJob|min|bezier|Convert|pow|push|Blender|val|document|callback|debug|newDims|new|dimensions|false|ctx|Plugin|bnum|process|Event|builder|id|imageData|_ref1|IO|exports|parentData|newLoc|divisor|PixelInfo|Store|NodeJS|Type|res|055|levels|Calculate|Layer|kernel|rgb|ctrl2|bias|caman|cps|ctrl1|clampRGB||target|true|getContext|chans|createElement|execute|_ref2|ratio|rand|processNext|ele|plugin|object|obj|devicePixelRatio|initObj|renderer|avg|throw|opacity|window|pixelInfo|fn|search|abs|Blocks|get|events|slice|imageHeight|imageWidth|undefined|trigger|modPixelData|hsv|layerData|hex|originalPixelData|curveY|lang|break|Canvas|CamanParser|1379310345|originalWidth|file|proxyUrl|cb|getImageData|level|Image|apply|add|leftCoord|finishInit|blockFinished|Analyze|switch|items|getAttribute|color|y1|chan|x1|builderIndex|to|pixelStack|drawImage|y0|fs|cropCoordinates|amt|x0|toLowerCase|opts|parseInt|currentLayer|attr|Fiber|imageLoaded|renderQueue|Cy|Cx|event|dataArray|floor|key|adjustSize|preScaledWidth|blockN|originalHeight|numPixels|string|Logger|copy|prop|getFloat|imgs|remoteProxy|y2|x2|continue|copyAttributes|filter|func|preScaledHeight|allowRevert|unparsedInstructions|scaledCanvas|hueToRGB|imageUrl|red|INST_REGEX|green|blue|curves|require|Invalid|lowBound|highBound|Bx|By|rightCoord|initializedPixelData|processFn|resized|startY|substr|startX|pixels|coord|dest|putImageData|oldCanvas|replaceCanvas|Root|blocksDone|disabled|root|sel|Array|setTimeout|in|hiDPIRatio|complete|hiDPIReplacement|vert|horiz|__hasProp|isURLRemote|matches|resize|fillColor|langToExt|initType|overwrite|04045|LayerDequeue|endY|endX|instFunc|inst|layerStack|finished|newLayer|uniqid|nodeName|crop|except|canvasQueue|try|match|backingStoreRatio|hiDPIDisabled|Ax|Ay|lastBlockN||blenders|blockPixelLength|Revert|eachBlock|value|processPlugin|finishedFn|job|listener|__slice|Kernel|0031308|4166666667|reloadCanvasData|whiteX|whiteY|whiteZ|008856451679|3333333333|787037037|readyState|plugins|2068965517|1284185493|xyz|curveX|bind|processKernel|naturalWidth|Single|waitForImageLoaded|catch|onload|_fn|_type|LoadOverlay|crossOrigin|x3|coordinatesToLocation|_ref3|console|info|y3|imageAdjustments|replaceChild|hexToRGB|__indexOf|parentNode|DOMUpdated|getAttrId|blendingMode|stats|LayerFinished|round|toBase64|version|hiDPIAdjustments|hasId|assignId|1000|executeLayer|pushContext|popContext|pop|applyCurrentLayer|applyToParent|node|gamma|sepia|invert|put|proxyParam|or|camanProxyUrl|scaled|rgbToHSV|initNode|hsvToRGB|parser|rgbToXYZ|parse|hidpi|initImage|initCanvas|style|renderKernel|renderBlock|ready|dataStr|px|colorize|Uint8Array|loaded|vibrance|executeFilter|executePlugin|loadOverlay|shift|RegExp|saturation|brightness|Width|domIsLoaded|hiDPICapable|toImage|Height|xyzToLab|newCanvas|parseArguments|render|setup|047|108|883|renderStart|err|delete|originalVisiblePixels|116|500|200|sqrt|autoload|randomRange|nowLoc|clip|has|reverse|types|processStart|processComplete|renderFinished|blockStarted|release|DOM|yield|initialized|luminance|needsHiDPISwap|totalBlocks|blockNum|Block|filterFunc|domainRegex|getPixelRelative|addEventListener|corsEnabled|swapped|use|isRemote|url|locationToCoordinates|noise|remoteCheck|from|error|log|remote|hue|contrast|proxy|URL|isImageLoaded|given|encodeURIComponent|mode|anonymous|date|greyscale|normal|item|setInitObject|cropped|setAttribute|channels|png|browserSave|DEBUG|nodeSave|charAt|save|proxies|js|javascript|replace|octet|stream|location|href|pl|perl|py|statSync|isFile|Creating|output|writeFile|toBuffer|Finished|writing|toDataURL|python|rb|ruby|layerID|createImageData|setBlendingMode|useProxy|copyParent|images|loading|overlayImage|Cannot|configured|without|load|warn|Attempting|domain|credentials|https|locationXY|http|listen|void|labToRGB|putPixelRelative|rgbToLab|getPixel|putPixel|labToXYZ|0570|os|cpus|2040|0557|0415|8758|9689|4986|5372|2406|default|xyzToRGB||9505|1192||0193|0722|7152|2126|1805|run|3576|4124|Executing|hslToRGB|rgbToHSL|caman_proxy|114|Start|End|587|299|startPixel|endPixel|toFixed|random|distance|Function|DOMContentLoaded|querySelectorAll|Rendering|blocksFinished|calculateLevels|reset|flush|revert|multiply|screen|overlay|backingStorePixelRatio|difference|addition|exclusion|softLight|lighten|darken|oBackingStorePixelRatio|msBackingStorePixelRatio|mozBackingStorePixelRatio|01|webkitBackingStorePixelRatio|scale|HiDPI|resetOriginalPixelData|naturalHeight|using|detected|Remote|onerror|Initializing|initialization|find|not|607|769|189|349|314|168|272|534|869|Could|readystatechange|analyze|isNaN|instanceof|Released|Version|toString|2013|fibers|nodeValue|attributes|split|number|of|exposure|extend|querySelector|hasOwnProperty|indexOf|missing'.split('|'),0,{}));